<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="ca"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="genweb.organs">
<body>

<metal:content-core fill-slot="content-core" tal:define="loginfo view/LogInformation">

  <link rel="stylesheet" href="++resource++genweb.organs.stylesheets/jqueryui-editable.css" />
  <script src=++resource++genweb.organs.stylesheets/jquery-ui.min.js></script>
  <script src="++resource++genweb.organs.stylesheets/jqueryui-editable.min.js"></script>
  <script src="++resource++genweb.organs.stylesheets/jquery.ui.touch-punch.min.js"></script>

  <script type="text/javascript">
    $(function() {
        var refreshNeeded = false;
        $('#sortable').sortable({
            placeholder: 'ui-state-highlight',
            opacity: 0.5,
            scroll: false,
            start: function(event, ui){
              start = ui.item.index();
            },
            update: function(event, ui){
              var params = {};
              params.itemid = ui.item.attr('id');
              params.action = 'movepunt';
              params.delta = ui.item.index() - start
              $.ajax({
                  type: 'POST',
                  url: '@@fcmoveTable',
                  data: params,
                  success: function(){
                    refreshNeeded = true;
                  },
              });
            },
        }).disableSelection();

        $('.sortable2').sortable({
            placeholder: 'ui-state-highlight2',
            opacity: 0.5,
            scroll: false,
            start: function(event, ui){
              start = ui.item.index();
            },
            update: function(event, ui){
              var params = {};
              params.itemid = ui.item.attr('id');
              params.action = 'movesubpunt';
              params.delta = ui.item.index() - start
              $.ajax({
                  type: 'POST',
                  url: '@@fcmoveTable',
                  data: params,
                  success: function(){
                    refreshNeeded = true;
                  },
              });
            },
        }).disableSelection();


        $(document).ajaxStop(function(){
          // All requests have completed, check if we need to refresh
           if(refreshNeeded){
              // Refresh the page (just a simple reload for now)
              window.location.reload();
          }
        });


      $('#sortable').bind('sortstart', function(event, ui) {
          $('.ui-state-highlight').append('<span class="textFloating">  </span>');
      });

      $('.sortable2').bind('sortstart', function(event, ui) {
          $('.ui-state-highlight2').append('<span class="textFloating">  </span>');
      });

      $('.addPunt').click(function(data){
        $('#newPunt').html('<div class="input-group"><input type="text" class="form-control" placeholder="Títol del punt" aria-describedby="basic-addon1" style="margin-bottom:1px; margin-right:10px;"><button type="button" class="btn btn-success" id="proceed" style="margin-right:5px;">Crear Punt</button><button type="button" class="btn btn-danger" id="hideBox">Cancel·lar</button></div>');
      });

      $('#newPunt').on('click','#hideBox', function(){
        $('#newPunt').html('');
      });

      $('#newPunt').on('click','#proceed', function(){
        $('#newPunt').html('Adding element...');
      });

    });

    function deleteElement(item){
      var params = {};

      params.item = item.id
      params.action = 'delete';
      $.ajax({
          type: 'POST',
          url: '@@removeElement',
          data: params,
      });
    }

  </script>

  <link rel="stylesheet" href="http://fontawesome.io/assets/font-awesome/css/font-awesome.css">

  <div class="modal fade" id="modalSession" tabindex="-1" role="dialog" aria-labelledby="modalSession">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><tal:omit-tag i18n:translate="">Ordre del dia</tal:omit-tag>
        </div>
        <div class="modal-body"></div>
      </div>
    </div>
  </div>

  <div style="float:right">
    <div style="display:flex">
      <div class="containerIcons">
        <a href="send_message" i18n:attributes="title Enviar; alt Enviar"><i class="fa fa-envelope fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Enviar</span></a>
      </div>
      <div class="containerIcons">
        <a i18n:attributes="title Presentacio; alt Presentacio" href="sessionAjax" data-toggle="modal" data-target="#modalSession"><i class="fa fa-play-circle-o fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Presentacio</span></a>
      </div>
      <div class="containerIcons">
        <a href="informar_sessio" i18n:attributes="title Informar; alt Informar"><i class="fa fa-newspaper-o fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Informar</span></a>
      </div>
    </div>
  </div>

  <div class="clearfix"></div>

  <div id="contentSessio">
    <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
      <li class="active"><a href="#dadesTab" data-toggle="tab" i18n:translate="">Dades</a></li>
      <li tal:condition="view/hihaPersones"><a href="#assistentsTab" data-toggle="tab" i18n:translate="">Assistents</a></li>
      <li tal:condition="view/showActaTab"><a href="#actaTab" data-toggle="tab" i18n:translate="">Acta</a></li>
      <li tal:condition="loginfo"><a href="#notificationsTab" data-toggle="tab" i18n:translate="">Historial</a></li>
    </ul>

    <div id="sessionTabs" class="tab-content">

      <div class="tab-pane active" id="dadesTab" tal:define="item view/valuesTable">
        <ul>
          <li tal:condition="item/dataSessio">
            <b i18n:translate="">Data</b><b>:</b>
            <span style="float:right"
                  tal:content="item/dataSessio"></span>
          </li>
          <li tal:condition="item/horaInici">
            <b i18n:translate="">Session start time</b><b>:</b>
            <span style="float:right"
                  tal:content="item/horaInici"></span>
          </li>
          <li tal:condition="item/horaFi">
            <b i18n:translate="">Session end time</b><b>:</b>
            <span style="float:right"
                  tal:content="item/horaFi"></span>
          </li>
          <li tal:condition="item/llocConvocatoria">
            <b i18n:translate="">Lloc</b><b>:</b>
            <span style="float:right"
                  tal:content="item/llocConvocatoria"></span>
          </li>
          <li tal:condition="item/organTitle">
            <b i18n:translate="">Organ de govern</b><b>:</b>
            <span style="float:right"
                  tal:content="item/organTitle"></span>
          </li>
        </ul>
      </div>

      <div class="tab-pane" id="assistentsTab" tal:condition="view/hihaPersones">
        <div class="panel with-nav-tabs panel-primary">
          <div class="panel-heading">
            <ul class="nav nav-tabs">
                <li tal:condition="context/membresConvocats" class="active">
                  <a href="#tab1primary" data-toggle="tab" i18n:translate="">Persones Convocades</a>
                </li>
                <li tal:condition="context/membresConvidats">
                  <a href="#tab2primary" data-toggle="tab" i18n:translate="">Persones convidades</a>
                </li>
                <li tal:condition="context/llistaExcusats">
                  <a href="#tab3primary" data-toggle="tab" i18n:translate="">Persones excusades</a>
                </li>
                <li tal:condition="context/noAssistents">
                  <a href="#tab4primary" data-toggle="tab" i18n:translate="">No assistents</a>
                </li>
            </ul>
          </div>
          <div class="panel-body">
            <div class="tab-content">
              <div tal:condition="context/membresConvocats" class="tab-pane fade in active" id="tab1primary">
                <span tal:replace="structure context/membresConvocats" />
              </div>
              <div tal:condition="context/membresConvidats" class="tab-pane fade" id="tab2primary">
                <span tal:replace="structure context/membresConvidats" />
              </div>
              <div tal:condition="context/llistaExcusats" class="tab-pane fade" id="tab3primary">
                <span tal:replace="structure context/llistaExcusats" />
              </div>
              <div tal:condition="context/noAssistents" class="tab-pane fade" id="tab4primary">
                <span tal:replace="structure context/noAssistents" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane" id="actaTab" tal:condition="view/showActaTab">
        <ul tal:condition="view/hihaMultimedia">
          <li tal:condition="context/enllacVideo">
            <b i18n:translate="">Video link</b><b>:</b>
            <br/>
            <a tal:attributes="href context/enllacVideo"><span tal:content="context/enllacVideo"></span></a>
          </li>
          <div class="clearfix"></div>
          <li tal:condition="context/enllacAudio">
            <b i18n:translate="">Audio link</b><b>:</b>
            <br/>
            <a tal:attributes="href context/enllacAudio"><span tal:content="context/enllacAudio"></span></a>
          </li>
        </ul>
        <div class="clearfix"></div>
        <div tal:define="actes view/ActesInside" tal:condition="actes">
          <table>
            <tbody>
              <tal:documents repeat="item actes">
                <tr>
                  <td>
                    <a href="#"
                       tal:attributes="href item/absolute_url;"
                       tal:content="item/title">
                        Item Title
                    </a>
                  </td>
                  <td>
                    <span tal:content="item/date">
                        Item Data
                    </span>
                  </td>
                </tr>
              </tal:documents>
            </tbody>
          </table>
        </div>
      </div>

      <div class="tab-pane" id="notificationsTab" tal:condition="loginfo">
        <table class="table table-condensed table-responsive" >
          <thead>
            <tr>
              <th>
                 <tal:data i18n:translate="">Data i hora</tal:data>
               </th>
              <th>
                <tal:data i18n:translate="">Accio</tal:data>
              </th>
              <th>
                <tal:data i18n:translate="">Notificador</tal:data>
              </th>
              <th>
                <tal:data i18n:translate="">Destinataris</tal:data>
              </th>
            </tr>
          </thead>
          <tbody>
            <tal:documents repeat="data loginfo">
              <tr>
                <td tal:content="data/dateMail"></td>
                <td tal:content="data/message"></td>
                <td tal:content="data/fromMail"></td>
                <td tal:content="data/toMail"></td>
              </tr>
            </tal:documents>
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <div class="modal fade" id="modalPunts" tabindex="-1" role="dialog" aria-labelledby="modalMassive">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="modalMassive" i18n:translate="">Creacio massiva de punts</h4>
        </div>
        <div class="modal-body"></div>
      </div>
    </div>
  </div>

  <div style="float:right" class="">
    <br/>
      <a class="btn btn-info" style="margin-bottom: 20px;" href="++add++genweb.organs.punt"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;<span i18n:translate="">Nou punt</span></a>
      <a class="btn btn-info" style="margin-bottom: 20px;" data-toggle="modal" href="manualStructureCreation" data-target="#modalPunts"><i class="fa fa-list" aria-hidden="true"></i>&nbsp;<span i18n:translate="">Crear punts</span></a>
  </div>

  <div tal:define="items view/PuntsInside" tal:condition="items" class="DADES">
  <br/>
    <h2 i18n:translate="">Ordre del dia</h2>

      <div class="clearfix"></div>

      <ul id="sortable">
        <tal:documents repeat="item items">
          <li class="ui-state-grey" tal:attributes="id item/id; class item/classe" >
            <td tal:condition="item/show">
              <div class="btn-group" role="group"
                   style="float: right;" aria-label="Edit actions">

                <button type="button" class="label label-success" title="Edit">
                   <a tal:attributes="href string:${item/absolute_url}/view">
                   <i class="fa fa-pencil" aria-hidden="true"></i></a></button>

                <button type="button" class="label label-important"
                  data-container="body"
                  data-toggle="popover"
                  data-placement="left"
                  data-html="true"
                  data-trigger="focus"
                  data-original-title="Delete"
                  tal:attributes="data-item item/id">
                  <i class="fa fa-trash-o" aria-hidden="true"></i></button>

              </div>
              <div class="puntTitle">
                <tal:omit-tag tal:content="item/proposalPoint"></tal:omit-tag>
                <a tal:attributes="data-pk item/id"
                   data-type="text" data-url="changeTitle"
                   class="editTitle editable editable-click titleSize">
                  <tal:omit-tag tal:content="item/title">Item Title</tal:omit-tag>
                </a>
                <span tal:condition="item/state" class="label nomarginLeft"
                      tal:content="item/state" tal:attributes="style string:background-color: ${item/css}"
                      i18n:domain="genweb.organs" i18n:translate=""></span>
                <tal:files tal:define="files python:view.filesinsidePunt(item)">
                  <ul style="list-style: none; padding-top:10px;">
                    <tal:documents repeat="item files">
                      <li class="filesinTable">
                        <i tal:attributes=" class item/classCSS"></i>
                        <a tal:attributes="href item/absolute_url;"
                           style="font-size:14px;">
                           <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                        </a>
                        <div style="float:right; display: inline-table;">
                          <label tal:attributes="class string:${item/labelClass}" tal:content="item/content"></label>
                          <a style="margin-right:3px;" type="button" class="remove label label-important"
                             data-title="Delete"
                             tal:attributes="href string:${item/absolute_url}/delete_confirmation" data-target="#delete"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
                        </div>
                      </li>
                    </tal:documents>
                  </ul>
                </tal:files>
              </div>
              <div class="llistaAfegir">
                <a style="margin-right: 3px;" class="addPunt"
                     data-title="Afegir nou punt"
                     tal:attributes="data-pk item/id"
                     ><i class="fa fa-plus" aria-hidden="true">&nbsp;Punt</i></a>&nbsp;
                <a style="margin-right: 3px;"
                     data-title="Afegir subpunt"
                     tal:attributes="href string:${item/absolute_url}/++add++genweb.organs.subpunt""><i class="fa fa-plus" aria-hidden="true">&nbsp;Subpunt</i></a>
                <a style="margin-right: 3px;"
                     data-title="Afegir document"
                     tal:attributes="href string:${item/absolute_url}/++add++genweb.organs.document""><i class="fa fa-plus" aria-hidden="true">&nbsp;Document</i></a>
                <a style="margin-right: 3px;"
                     data-title="Afegir subpunt"
                     tal:attributes="href string:${item/absolute_url}/++add++genweb.organs.file"><i class="fa fa-plus" aria-hidden="true">&nbsp;Fitxer</i></a>
              </div>
              <div tal:define="subpunts python:view.SubpuntsInside(item)" tal:condition="subpunts" class="sortable2">
                <tal:subpunts repeat="item subpunts">
                  <ol class="li_subgrups" tal:attributes="id item/id">
                    <td>
                      <div class="btn-group" role="group"
                           style="float: right;" aria-label="Edit actions">
                        <a style="margin-right: 3px;" type="button"
                           class="edit label label-info" data-title="Edit"
                           tal:attributes="href string:${item/absolute_url}/view"><i class="fa fa-pencil" aria-hidden="true"></i></a>
                        <a type="button" class="remove label label-important" data-title="Delete"
                           tal:attributes="href string:${item/absolute_url}/delete_confirmation" data-target="#delete"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
                      </div>
                      <div class="subpuntTitle">
                        <tal:omit-tag tal:content="item/proposalPoint"></tal:omit-tag>
                        <a tal:attributes="data-pk item/id"
                           data-type="text" data-url="changeTitle"
                           class="editTitle editable editable-click titleSize">
                          <tal:omit-tag tal:content="item/title">Item Title</tal:omit-tag>
                        </a>
                        <span tal:condition="item/state" class="label nomarginLeft"
                              tal:content="item/state" tal:attributes="style string:background-color: ${item/css}"
                              i18n:domain="genweb.organs" i18n:translate=""></span>
                        <tal:files tal:define="files python:view.filesinsideSubPunt(item)">
                          <ul style="list-style: none; padding-top:10px;">
                            <tal:documents repeat="item files">
                              <li class="filesinTable">
                                <i tal:attributes=" class item/classCSS"></i>
                                <a tal:attributes="href item/absolute_url;"
                                   style="font-size:14px;">
                                   <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                                </a>
                                <div style="float:right; display: inline-table;">
                                  <label tal:attributes="class string:${item/labelClass}" tal:content="item/content"></label>
                                  <a style="margin-right:3px;" type="button" class="remove label label-important"
                                     data-title="Delete"
                                     tal:attributes="href string:${item/absolute_url}/delete_confirmation" data-target="#delete"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
                                </div>
                              </li>
                            </tal:documents>
                          </ul>
                        </tal:files>
                      </div>
                      <div class="llistaAfegir">
                        <a style="margin-right: 3px;"
                             data-title="Afegir document"
                             tal:attributes="href string:${item/absolute_url}/++add++genweb.organs.document""><i class="fa fa-plus" aria-hidden="true">&nbsp;Document</i></a>
                        <a style="margin-right: 3px;"
                             data-title="Afegir subpunt"
                             tal:attributes="href string:${item/absolute_url}/++add++genweb.organs.file"><i class="fa fa-plus" aria-hidden="true">&nbsp;Fitxer</i></a>
                      </div>
                    </td>
                  </ol>
                </tal:subpunts>
              </div>
            </td>
            <div id="newPunt"></div>
          </li>
        </tal:documents>
      </ul>
  </div>

  <script type="text/javascript">
    $(function() {
        var reloadEdit = false;
        $.fn.editable.defaults.mode = 'inline';
        $.fn.editable.defaults.showbuttons = false;
        $.fn.editable.defaults.type = 'text';
        $.fn.editable.defaults.emptytext = 'Sense valor';

        $('.editTitle').editable({
            inputclass: function(e, f) {
              $("a[aria-describedby=" + $(this).closest(".ui-tooltip").prop("id") + "]").data("shared", this);
            },
            validate: function(value) {
              if (!value) return 'Camp obligatori';
            },
            success: function(){
                  reloadEdit = true;
            },
        });

        $(document).ajaxStop(function(){
          // All requests have completed, check if we need to refresh
           if(reloadEdit){
              // Refresh the page (just a simple reload for now)
              window.location.reload();
          }
        });



$('[data-toggle="popover"]').popover({
});

$('button.label.label-important').on('click', function (e) {
    $('[data-toggle="popover"]').each(function () {
        //the 'is' for buttons that trigger popups
        //the 'has' for icons within a button that triggers a popup
        if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
            $(this).popover('hide');
        } else {
          var name=$(this).data()['item'];
          var message='<a class="btn btn-default"> No </a>&nbsp;<a class="btn btn-danger" onclick=deleteElement('+ name +')> Si </a>'
          console.log(message)
          // debugger
          $("[data-toggle='popover']").popover().data("popover").tip().find('.popover-content').html(message);
        }
    });
});

        // $("button.label.label-important").each(function(){
        //    // $("[data-toggle='popover']").not(this).popover('hide');
        //     var name = $(this).data()['item'];
        //     console.log(name)
        //     var message =  '<a class="btn btn-default"> No </a>&nbsp;<a class="btn btn-danger" onclick=deleteElement('+ name +')> Si </a>'
        //     $("[data-toggle='popover']").popover({
        //         content: message
        //       }).data("popover");
        // });

    });
  </script>

  <div style="margin-bottom:20px;"></div>


</metal:content-core>

</body>
</html>
