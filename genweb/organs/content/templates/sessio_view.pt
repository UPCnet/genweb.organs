<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="ca"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="genweb.organs">
<body>

<metal:content-core fill-slot="content-core"
    tal:define="loginfo view/getAnnotations;
                isAfectat view/isAfectat;
                isMembre view/isMembre;
                isEditor view/isEditor;
                isSecretari view/isSecretari;
                isManager view/isManager;
                canModify view/canModify;
                items view/PuntsInside">

  <link tal:condition="canModify" rel="stylesheet" tal:attributes="href string:${portal_url}/++resource++genweb.organs.stylesheets/jqueryui-editable.css" />
  <script tal:condition="canModify" tal:attributes="src string:${portal_url}/++resource++genweb.organs.stylesheets/jquery-ui.min.js"></script>
  <script tal:condition="canModify" tal:attributes="src string:${portal_url}/++resource++genweb.organs.stylesheets/jqueryui-editable.min.js"></script>
  <script tal:condition="canModify" tal:attributes="src string:${portal_url}/++resource++genweb.organs.stylesheets/jquery.ui.touch-punch.min.js"></script>


  <script type="text/javascript" tal:condition="canModify">
    $(function() {
        var refreshNeeded = false;
        $('#sortable').sortable({
            placeholder: 'ui-state-highlight',
            opacity: 0.5,
            scroll: false,
            start: function(event, ui){
              start = ui.item.index();
            },
            update: function(event, ui){
              var params = {};
              params.itemid = ui.item.attr('id');
              params.action = 'movepunt';
              params.delta = ui.item.index() - start
              $.ajax({
                  type: 'POST',
                  url: '@@fcmoveTable',
                  data: params,
                  success: function(){
                    refreshNeeded = true;
                  },
              });
            },
        }).disableSelection();

        $('.sortable2').sortable({
            placeholder: 'ui-state-highlight2',
            opacity: 0.5,
            scroll: false,
            start: function(event, ui){
              start = ui.item.index();
            },
            update: function(event, ui){
              var params = {};
              params.itemid = ui.item.attr('id');
              params.action = 'movesubpunt';
              params.delta = ui.item.index() - start
              $.ajax({
                  type: 'POST',
                  url: '@@fcmoveTable',
                  data: params,
                  success: function(){
                    refreshNeeded = true;
                  },
              });
            },
        }).disableSelection();

        $(document).ajaxStop(function(){
           if(refreshNeeded){
              window.location.reload();
          }
        });

      $('#sortable').bind('sortstart', function(event, ui) {
          $('.ui-state-highlight').append('<span class="textFloating">  </span>');
      });

      $('.sortable2').bind('sortstart', function(event, ui) {
          $('.ui-state-highlight2').append('<span class="textFloating">  </span>');
      });

    });

    function deleteElement(item){
      var params = {};
      values = item.split(',')
      params.item = values[0]
      params.portal_type = values[1]
      params.action = 'delete';
      $.ajax({
          type: 'POST',
          url: '@@removeElement',
          data: params,
          success: function(){
                  refreshNeeded = true;
                },
      });
      $(document).ajaxStop(function(){
         if(refreshNeeded){
            window.location.reload();
        }
      });
    }

  </script>

  <script type="text/javascript" tal:condition="canModify">
    function printPage(newWindow){
      newWindow.focus();
      newWindow.print();
    }
  </script>

  <div class="documentDescription description"></div>

  <iframe name="iframe" id="iframe" width="1" height="1" src="butlleti"></iframe>

  <div style="float:right; display:flex">
      <div class="containerIcons" tal:condition="view/showEnviarButton">
        <a href="send_message" i18n:attributes="title Enviar; alt Enviar"><i class="fa fa-envelope fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Enviar</span></a>
      </div>
      <div class="containerIcons" tal:condition="view/showPresentacionButton">
        <a i18n:attributes="title Presentacio; alt Presentacio" href="presentation" target="_blank"><i class="fa fa-play-circle-o fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Presentacio</span></a>
      </div>
      <div class="containerIcons" tal:condition="view/showPublicarButton">
        <a href="informar_sessio" i18n:attributes="title Informar; alt Informar"><i class="fa fa-newspaper-o fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Informar</span></a>
      </div>

      <div class="containerIcons" tal:condition="canModify">
        <a href="javascript:printPage(iframe);" i18n:attributes="title printOrdreDia; alt printOrdreDia"><i class="fa fa-print fa-3x" aria-hidden="true"></i><br/><span i18n:translate="">Print</span></a>
      </div>
  </div>

  <div class="clearfix"></div>

  <div id="contentSessio">
    <ul id="tabs" class="nav nav-tabs" data-tabs="tabs">
      <li class="active"><a href="#dadesTab" data-toggle="tab" i18n:translate="">Dades</a></li>
      <li tal:condition="view/hihaPersones"><a href="#assistentsTab" data-toggle="tab" i18n:translate="">Assistents</a></li>
      <li tal:condition="view/showActaTab"><a href="#actaTab" data-toggle="tab" i18n:translate="">Acta</a></li>
      <li tal:condition="python:loginfo and canModify"><a href="#notificationsTab" data-toggle="tab" i18n:translate="">Historial</a></li>
    </ul>

    <div id="sessionTabs" class="tab-content">

      <div class="tab-pane active" id="dadesTab" tal:define="item view/valuesTable">
        <ul>
          <li tal:condition="view/dataSessio">
            <b i18n:translate="">Data</b><b>:</b>
            <span style="float:right"
                  tal:content="view/dataSessio"></span>
          </li>
          <li tal:condition="view/horaInici">
            <b i18n:translate="">Session start time</b><b>:</b>
            <span style="float:right"
                  tal:content="view/horaInici"></span>
          </li>
          <li tal:condition="view/horaFi">
            <b i18n:translate="">Session end time</b><b>:</b>
            <span style="float:right"
                  tal:content="view/horaFi"></span>
          </li>
          <li tal:condition="item/llocConvocatoria">
            <b i18n:translate="">Session location</b><b>:</b>
            <span style="float:right"
                  tal:content="item/llocConvocatoria"></span>
          </li>
          <li tal:condition="item/organTitle">
            <b i18n:translate="">Organ de govern</b><b>:</b>
            <span style="float:right"
                  tal:content="item/organTitle"></span>
          </li>
        </ul>
      </div>

      <div class="tab-pane" id="assistentsTab" tal:condition="view/hihaPersones">
        <div class="panel with-nav-tabs panel-primary">
          <div class="panel-heading">
            <ul class="nav nav-tabs">
                <li tal:condition="context/membresConvocats" class="active">
                  <a href="#tab1primary" data-toggle="tab" i18n:translate="">Persones Convocades</a>
                </li>
                <li tal:condition="context/membresConvidats">
                  <a href="#tab2primary" data-toggle="tab" i18n:translate="">Persones convidades</a>
                </li>
                <li tal:condition="context/llistaExcusats">
                  <a href="#tab3primary" data-toggle="tab" i18n:translate="">Persones excusades</a>
                </li>
                <li tal:condition="context/noAssistents">
                  <a href="#tab4primary" data-toggle="tab" i18n:translate="">No assistents</a>
                </li>
            </ul>
          </div>
          <div class="panel-body">
            <div class="tab-content">
              <div tal:condition="context/membresConvocats" class="tab-pane fade in active" id="tab1primary">
                <span tal:replace="structure context/membresConvocats" />
              </div>
              <div tal:condition="context/membresConvidats" class="tab-pane fade" id="tab2primary">
                <span tal:replace="structure context/membresConvidats" />
              </div>
              <div tal:condition="context/llistaExcusats" class="tab-pane fade" id="tab3primary">
                <span tal:replace="structure context/llistaExcusats" />
              </div>
              <div tal:condition="context/noAssistents" class="tab-pane fade" id="tab4primary">
                <span tal:replace="structure context/noAssistents" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane" id="actaTab" tal:condition="view/showActaTab">
        <div class="clearfix" tal:define="actes view/ActesInside" tal:condition="actes">
          <b i18n:translate="">Actes de la sessio:</b>
          <table>
            <tbody>
              <tal:documents repeat="item actes">
                <tr>
                  <td><i class="fa fa-file-text-o" aria-hidden="true" style="padding-left: 20px;"></i>
                    <a href="#"
                       tal:attributes="href item/absolute_url;"
                       tal:content="item/title">
                        Item Title
                    </a>&nbsp;
                    (<span tal:content="item/date">
                        Item Data
                    </span>)
                  </td>
                </tr>
              </tal:documents>
            </tbody>
          </table>
        </div>
      </div>

      <div class="tab-pane" id="notificationsTab" tal:condition="python:loginfo and canModify">
        <table class="table table-bordered table-condensed table-hover logFont">
          <thead>
            <tr>
              <th>
                 <tal:data>#</tal:data>
               </th>
              <th>
                 <tal:data i18n:translate="">Data i hora</tal:data>
               </th>
              <th>
                <tal:data i18n:translate="">Accio</tal:data>
              </th>
              <th>
                <tal:data i18n:translate="">Notificador</tal:data>
              </th>
              <th>
                <tal:data i18n:translate="">Destinataris</tal:data>
              </th>
            </tr>
          </thead>
          <tbody>
            <tal:documents repeat="data loginfo">
              <tr>
                <td tal:content="data/index|nothing"></td>
                <td tal:content="data/dateMail"></td>
                <td tal:content="data/message"></td>
                <td tal:content="data/fromMail"></td>
                <td tal:content="data/toMail"></td>
              </tr>
            </tal:documents>
          </tbody>
        </table>
      </div>

    </div>
  </div>

  <div tal:condition="canModify" class="modal fade massivePuntsModal" id="modalPunts" tabindex="-1" role="dialog" aria-labelledby="modalMassive">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="modalMassive" i18n:translate="">Importar llista de punts i subpunts</h4>
        </div>
        <div class="modal-body"></div>
      </div>
    </div>
  </div>

  <div tal:condition="canModify" class="modal fade modalPuntModal" id="modalPunt" tabindex="-1" role="dialog" aria-labelledby="modalAddPunt">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="modalAddPunt" i18n:translate="">Afegir un punt informatiu</h4>
        </div>
        <div class="modal-body">
          <form name="addPunt">
            <div class="form-group">
              <label for="message-text" class="control-label" i18n:translate="">Title</label>
              <textarea class="form-control" id="message-text"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary createPunt" i18n:translate="">Envia</button>
          <button type="button" class="btn btn-default" data-dismiss="modal" i18n:translate="">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div tal:condition="canModify" class="modal fade modalPuntAcord" id="modalAcord" tabindex="-1" role="dialog" aria-labelledby="modalAddAcord">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="modalAddAcord" i18n:translate="">Afegir un acord</h4>
        </div>
        <div class="modal-body">
          <form name="addAcord">
            <div class="form-group">
              <label for="message-text" class="control-label" i18n:translate="">Titol del punt</label>
              <textarea class="form-control" id="message-text"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary createAcord" i18n:translate="">Envia</button>
          <button type="button" class="btn btn-default" data-dismiss="modal" i18n:translate="">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div style="float:right" tal:condition="canModify">
    <br/>
      <a class="btn btn-info" style="margin-bottom: 20px;" data-toggle="modal" data-target="#modalPunt"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;<span i18n:translate="">Nou punt</span></a>
      <a class="btn btn-info" style="margin-bottom: 20px;" data-toggle="modal" data-target="#modalAcord"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;<span i18n:translate="">Nou acord</span></a>
      <a class="btn btn-info" style="margin-bottom: 20px;" data-toggle="modal" href="manualStructureCreation" data-target="#modalPunts"><i class="fa fa-database" aria-hidden="true"></i>&nbsp;<span i18n:translate="">Llista punts</span></a>
      <a class="btn btn-info" style="margin-bottom: 20px;" href="updateProposalPoints" data-target="#modalPunts"><i class="fa fa-refresh" aria-hidden="true"></i>&nbsp;<span i18n:translate="">Recalcula punts/acords</span></a>
  </div>

<div tal:condition="view/hihaPunts">
  <div tal:condition="items" class="DADES">
      <div class="clearfix"></div>

      <h2 style="margin-top:0px; text-align: left; float: left;" i18n:translate="">Ordre del dia</h2>

      <div style="text-align: right; float: left; display: inline; margin-top:0px; margin-bottom:15px; margin-left: 20px;" class="btn-group" role="group" aria-label="Show as" tal:condition="canModify">
        <button class="label dropdown-toggle"
            type="button" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false" i18n:translate="">
            Veure com...
          <span class="caret"></span>
        </button>
        <ul style="text-align: left;" class="dropdown-menu" role="menu" aria-labelledby="types">
          <li><a tabindex="-1" href="view_as_role?id=OG3-Membre"><span i18n:translate="">Membre</span></a></li>
          <li><a tabindex="-1" href="view_as_role?id=OG4-Afectat"><span i18n:translate="">Afectat</span></a></li>
          <li><a tabindex="-1" href="view_as_role?id=Public"><span i18n:translate="">Public</span></a></li>
        </ul>
      </div>
      <div class="clearfix"></div>


      <ul id="sortable">
        <tal:documents repeat="item items">
          <tal:block tal:define="agreement item/agreement">
          <li class="ui-state-grey" tal:attributes="id item/id; class item/classe">
            <td tal:condition="item/show">
            <div class="span6 agreementSpan">
              <span class="agreementClass" tal:content="agreement" tal:condition="agreement"></span>
            </div>
            <div class="span6 einesSpan">
              <div style="float: right;" aria-label="Edit actions"  tal:condition="canModify">
                <button type="button" class="edit label label-info"
                  data-original-title="Edit">
                  <i class="fa fa-pencil" aria-hidden="true"></i></button>
                <button type="button" class="remove label label-important"
                  data-container="body"
                  data-toggle="popover"
                  data-placement="left"
                  data-html="true"
                  data-trigger="focus"
                  data-original-title="Esborrar"
                  tal:attributes="data-item item/id; data-type item/portal_type">
                  <i class="fa fa-trash-o" aria-hidden="true"></i>
                </button>
              </div>
              <div class="btn-group" role="group"
                   style="float: right;" aria-label="Add element" tal:condition="canModify">
                  <button class="label dropdown-toggle"
                      type="button" data-toggle="dropdown"
                      aria-haspopup="true" aria-expanded="false">
                      +
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                    <li tal:condition="item/isPunt"><a tabindex="-1" tal:attributes="href string:${item/id}/++add++genweb.organs.subpunt"><span i18n:translate="">Subpunt</span></a></li>
                    <li tal:condition="item/isPunt"><a tabindex="-1" tal:attributes="href string:${item/id}/++add++genweb.organs.acord"><span i18n:translate="">Acord</span></a></li>
                    <li><a tabindex="-1" tal:attributes="href string:${item/id}/++add++genweb.organs.file"><span i18n:translate="">File</span></a></li>
                    <li><a tabindex="-1" tal:attributes="href string:${item/id}/++add++genweb.organs.document"><span i18n:translate="">Document</span></a></li>
                  </ul>
              </div>

              <div class="btn-group" role="group" tal:condition="canModify"
                   style="float: right;" aria-label="States">
                <tal:block tal:condition="item/state">
                  <button class="label dropdown-toggle bullet-toggle"
                      type="button" data-toggle="dropdown"
                      aria-haspopup="true" aria-expanded="false">
                      <i class="fa fa-circle" aria-hidden="true" tal:attributes="style string:color:${item/css}"></i>
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu estatsToggle" role="menu" aria-labelledby="estats">
                    <tal:block repeat="estat item/estats">
                      <li class="defaultValue">
                      <a tabindex="-1" tal:attributes="href string:changeActualState?estat=${estat/title}&id=${item/item_path}"><i class="fa fa-circle" aria-hidden="true" tal:attributes="style string:color:${estat/color}"></i>&nbsp;<span tal:content="estat/title"></span></a></li>
                    </tal:block>
                  </ul>
                </tal:block>
              </div>

              <div tal:condition="not:canModify" style="float: right;">
                <tal:block tal:condition="item/state">
                  <button class="btn label disabled " style="padding:3px;">
                  <i class="fa fa-circle" aria-hidden="true"  tal:attributes="style string:color:${item/css}"></i>
                  <span  tal:content="item/state"></span>
                  </button>
                </tal:block>
              </div>
            </div>
            <div class="puntTitle span12">
                  <div class="span1 fletxaSpan">
                    <button type="button" class="expand" tal:condition="item/items_inside"
                      data-original-title="Expand" style="font-size:20px;"">
                      <i style="color: #557c95" class="fa fa-chevron-down" aria-hidden="true"></i>
                      </button>
                    <button type="button" class="notexpand" tal:condition="item/items_inside"
                      data-original-title="Collapse" style="font-size:20px;">
                      <i  style="color: #557c95" class="fa fa-chevron-up" aria-hidden="true"></i>
                      </button>
                  </div>
                  <div class="span1 numberSpan">
                      <span class="proposalNumber" style="text-align: right; float:right;" tal:content="item/proposalPoint"></span>
                  </div>
                  <div class="span10 titleSpan">
                    <a tal:attributes="data-pk item/id; href item/absolute_url"
                       data-url="changeTitle"
                       class="editTitle editable titleSize">
                      <tal:omit-tag tal:content="item/title">Item Title</tal:omit-tag>
                    </a>


                <tal:files tal:define="files python:view.filesinsidePunt(item)">
                  <ul class="listFiles" tal:condition="files">
                    <tal:documents repeat="item files">
                      <li class="filesinTable">
                        <i tal:attributes="class item/classCSS"></i>
                        <a tal:attributes="href item/absolute_url;"
                           style="font-size:14px;">
                           <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                        </a>
                        <div style="float:right; display: inline-table;" tal:condition="canModify">
                           <button type="button" class="remove label label-important"
                              data-container="body"
                              data-toggle="popover"
                              data-placement="left"
                              data-html="true"
                              data-trigger="focus"
                              data-original-title="Delete"
                              tal:attributes="data-item item/id; data-type item/portal_type">
                              <i class="fa fa-trash-o" aria-hidden="true"></i>
                            </button>
                        </div>
                      </li>
                    </tal:documents>
                  </ul>
                </tal:files>
                  </div>
              </div>

              <div tal:define="subpunts python:view.SubpuntsInside(item)" tal:condition="subpunts" class="sortable2">
                <tal:subpunts repeat="itemSubpunt subpunts">
                  <ol class="li_subgrups" tal:attributes="id itemSubpunt/id">
                    <div class="span6 agreementSpan">
                      <span class="agreementSubClass" tal:content="itemSubpunt/agreement" tal:condition="itemSubpunt/agreement"></span>
                    </div>
                    <div class="span6 einesSpan">
                      <div style="float: right;" aria-label="Subpunt actions" tal:condition="canModify">
                        <button type="button" class="edit2 label label-info"
                          data-original-title="Edit">
                          <i class="fa fa-pencil" aria-hidden="true"></i>
                        </button>
                        <button type="button" class="remove label label-important"
                              data-container="body"
                              data-toggle="popover"
                              data-placement="left"
                              data-html="true"
                              data-trigger="focus"
                              data-original-title="Delete"
                              tal:attributes="data-item itemSubpunt/id; data-type itemSubpunt/portal_type">
                              <i class="fa fa-trash-o" aria-hidden="true"></i>
                        </button>
                      </div>

                      <div class="btn-group" role="group" style="float: right;"
                           aria-label="Add element" tal:condition="canModify">
                          <button class="label dropdown-toggle"
                              type="button" data-toggle="dropdown"
                              aria-haspopup="true" aria-expanded="false">
                              +
                            <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                            <li><a tabindex="-1" tal:attributes="href string:${itemSubpunt/id}/++add++genweb.organs.file"><span i18n:translate="">File</span></a></li>
                            <li><a tabindex="-1" tal:attributes="href string:${itemSubpunt/id}/++add++genweb.organs.document"><span i18n:translate="">Document</span></a></li>
                          </ul>
                      </div>

                      <div class="btn-group" role="group" tal:condition="canModify"
                           style="float: right;" aria-label="Subpunt actions">
                        <tal:block tal:condition="itemSubpunt/state">
                          <button class="label dropdown-toggle bullet-toggle"
                              id="estats" type="button" data-toggle="dropdown"
                              aria-haspopup="true" aria-expanded="false">
                              <i class="fa fa-circle" aria-hidden="true" tal:attributes="style string:color:${itemSubpunt/css}"></i>
                            <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu estatsToggle" role="menu" aria-labelledby="estats">
                            <tal:block repeat="estat itemSubpunt/estats">
                              <li class="defaultValue"><a tabindex="-1" tal:attributes="href string:changeSubpuntState?estat=${estat/title}&id=${itemSubpunt/id}"><i class="fa fa-circle" aria-hidden="true" tal:attributes="style string:color:${estat/color}"></i>&nbsp;<span tal:content="estat/title"></span></a></li>
                            </tal:block>
                          </ul>
                        </tal:block>
                      </div>

                      <div tal:condition="not:canModify" style="float: right;">
                        <tal:block tal:condition="itemSubpunt/state">
                          <button class="btn label disabled " style="padding:3px;">
                          <i class="fa fa-circle" aria-hidden="true"  tal:attributes="style string:color:${itemSubpunt/css}"></i>
                          <span tal:content="itemSubpunt/state"></span>
                          </button>
                        </tal:block>
                      </div>
                    </div>

                    <div class="subpuntTitle span12">
                      <div class="span1">
                        <span class="proposalNumberSubpunt" tal:content="itemSubpunt/proposalPoint"></span>
                      </div>
                      <div class="span11">
                        <a tal:attributes="data-pk itemSubpunt/id; href itemSubpunt/absolute_url"
                             data-type="text" data-url="changeTitle"
                             class="editTitle editable subtitleSize">
                            <tal:omit-tag tal:content="itemSubpunt/title">Item Title</tal:omit-tag>
                        </a>

                      <tal:files tal:define="files python:view.filesinsidePunt(itemSubpunt)">
                        <ul style="list-style: none;" tal:condition="files">
                          <tal:documents repeat="item files">
                            <li class="filesinTable">
                              <i tal:attributes="class item/classCSS"></i>
                              <a tal:attributes="href item/absolute_url;"
                                 style="font-size:14px;">
                                 <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                              </a>
                              <div style="float:right; display: inline-table;" tal:condition="canModify">
                                <button type="button" class="remove label label-important"
                                      data-container="body"
                                      data-toggle="popover"
                                      data-placement="left"
                                      data-html="true"
                                      data-trigger="focus"
                                      data-original-title="Delete"
                                      tal:attributes="data-item item/id; data-type item/portal_type">
                                      <i class="fa fa-trash-o" aria-hidden="true"></i></button>
                              </div>
                            </li>
                          </tal:documents>
                        </ul>
                      </tal:files>
                      </div>
                    </div>

                  </ol>
                </tal:subpunts>
              </div>
            </td>
          </li>
          </tal:block>
        </tal:documents>
      </ul>
  </div>

  <script type="text/javascript">
    $(function() {
        $(this).find('.sortable2').hide()
        $(this).find('.listFiles').hide()
        $(this).find('.notexpand').hide()
        $('.expand').click(function(e){
               e.stopPropagation();
               $(this).parent().parent().find('.expand').hide()
               $(this).parent().parent().find('.expand').slideUp()
               $(this).parent().parent().find('.notexpand').show()
               $(this).parent().parent().parent().find('.sortable2').slideDown()
               $(this).parent().parent().parent().find('.listFiles').slideDown()
        });

        $('.notexpand').click(function(e){
               e.stopPropagation();
               $(this).parent().parent().find('.notexpand').hide()
               $(this).parent().parent().find('.expand').show()
               $(this).parent().parent().parent().find('.sortable2').slideUp()
               $(this).parent().parent().parent().find('.listFiles').slideUp()
        });
    });
  </script>

  <script type="text/javascript" tal:condition="canModify">
    $(function() {
        var reloadEdit = false;
         $.fn.editable.defaults.mode = 'inline';
         $.fn.editable.defaults.showbuttons = false;
         $.fn.editable.defaults.type = 'text';
         $.fn.editable.defaults.toggle = 'manual';
         $.fn.editable.defaults.emptytext = '';
         $(this).find('.sortable2').hide()
         $(this).find('.listFiles').hide()
         $(this).find('.notexpand').hide()

         $('.editTitle').editable({
             inputclass: function(e, f) {
               $("a[aria-describedby=" + $(this).closest(".ui-tooltip").prop("id") + "]").data("shared", this);
             },
             validate: function(value) {
               if (!value) return 'Camp obligatori';
             },
             success: function(){
                   reloadEdit = true;
             },
         });

         $('.agreement').editable({
          toggle: 'click',
             inputclass: function(e, f) {
               $("a[aria-describedby=" + $(this).closest(".ui-tooltip").prop("id") + "]").data("shared", this);
             },
         });

         $(document).ajaxStop(function(){
            if(reloadEdit){
               window.location.reload();
           }
         });

        $('.edit').click(function(e){
               e.stopPropagation();
               $(this).parent().parent().parent('li:first').find('a.titleSize').editable('toggle')
        });

        $('.edit2').click(function(e){
               e.stopPropagation();
               $(this).parent().parent().parent('ol:first').find('a.subtitleSize').editable('toggle')
        });

        $('button.remove').on('click', function (e) {
            $('[data-toggle="popover"]').each(function () {
                if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                    $(this).popover('hide');
                } else {
                  var name=$(this).data()['item'];
                  var portal_type=$(this).data()['type'];
                  var message='<a class="btn btn-info"> No </a>&nbsp;<a class="btn btn-danger" onclick=deleteElement("'+ name +','+ portal_type+'")> Si </a>'
                  $(this).attr('data-content',message);
                  $(this).popover('show');
                }
            });
        });

        $("li.defaultValue").on('click', function(){
            var colorSelected = $(this).find('.fa').css('color');
            $(this).parent().parent().parent().parent().find('.bullet-toggle > i').css({'color': colorSelected});
        });

  })
  </script>
</div>
  <div style="margin-bottom:20px;"></div>

<script type="text/javascript">
  var refreshNeeded = false;
  $(".createPunt").on('click', function(){
    var value = $("#modalPunt #message-text").val()
    var params = {};
    params.action = 'createPunt';
    params.name = value;
    $.ajax({
            type: 'POST',
            url: '@@createElement',
            data: params,
            success: function(){
              refreshNeeded = true;
            },
    });
  });

  $(".createAcord").on('click', function(){
    var value = $("#modalAcord #message-text").val()
    var params = {};
    params.action = 'createAcord';
    params.name = value;
    $.ajax({
            type: 'POST',
            url: '@@createElement',
            data: params,
            success: function(){
              refreshNeeded = true;
            },
    });
  });

  $(document).ajaxStop(function(){
     if(refreshNeeded){
        window.location.reload();
    }
  });
</script>

</metal:content-core>

</body>
</html>
