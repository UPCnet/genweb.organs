<div id="calendari" class="portlet portlet-calendari portletCalendar"  tal:define="year view/year;" i18n:domain="plone">

  <div>


           <header class="portlet-header">
             <a href="#" rel="nofollow" class="calendari-anterior" title="Previous month"
                tal:define="prev_month view/prev_month; prev_year view/prev_year; "
                tal:attributes="href view/prev_query; data-year prev_year; data-month prev_month;"
                i18n:attributes="title title_previous_month;"></a>
             <h3>
                <span i18n:translate="" tal:omit-tag="">
                   <span i18n:name="monthname" i18n:translate="" tal:content="view/month_name" tal:omit-tag="">monthname</span>
                </span>
                <span i18n:translate="" tal:omit-tag="">
                   <span i18n:name="year" i18n:translate="" tal:content="year" tal:omit-tag="">year</span>
                </span>
             </h3>
             <a href="#" rel="nofollow" class="calendari-seguent" title="Next month"
                tal:define="next_month view/next_month; next_year view/next_year"
                tal:attributes="href view/next_query; data-year next_year; data-month next_month; "
                i18n:attributes="title title_next_month;"></a>
           </header>

    <article class="portlet-content">
    <div class="pad">
      <table class="calendari" summary="Calendar"
          i18n:attributes="summary summary_calendar">
        <thead>
          <tr class="weekdays">
            <tal:data repeat="weekday view/weekdays">
              <th scope="col" i18n:translate="" tal:content="weekday">Su</th>
            </tal:data>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="week view/cal_data">
            <tal:block repeat="day week">
              <td tal:define="today day/today;
                            next_month day/next_month;
                            prev_month day/prev_month;
                            events day/events;
                            classtag python:view.getclasstag_event(day);
                            limit python:len(events) if events is not None else 0"
                  tal:attributes="class python:u'%s%s%s%s%s' %
                            ((today and ' today' or ''),
                            (next_month and ' cal_next_month' or ''),
                            (prev_month and ' cal_prev_month' or ''),
                            (events and ' cal_has_events' or ''),
                            (classtag or ''));
                            style string:background-color:${day/color};
                            data-year day/year; data-month day/month; data-day day/day;">
                  <a tal:omit-tag="not:events" tal:content="day/day">31</a>
                </td>
              </tal:block>
            </tr>
        </tbody>
      </table>
    </div>
  </article>
    <ul class="icons-ul">
      <tal:block tal:repeat="events view/getDayEventsGroup">
        <li tal:attributes="class string:${events/community_type} text">
          <p tal:repeat="event events/events">
            <a tal:attributes="href event/getURL">
              <tal:event content="event/start"> 07/12 </tal:event>
              <span tal:condition="event/end">
                <span i18n:translate=""> to </span>
                <tal:event content="event/end"> 07/12 </tal:event>
              </span>
              - <tal:event content="event/Title"> Event Title </tal:event>
            </a>
          </p>
          <div class="clearfix"></div>
          <span class="text2">
            <i class="fa fa-thumb-tack"></i>
            <a tal:attributes="href events/community_url" tal:content="events/community_name"></a>
          </span>
        </li>
      </tal:block>
    </ul>

  </div>

</div>


<script type="text/javascript">
$(document).ready(function () {

    // javascript per al canvi de mes al portlet de calendari
    rebind_portlet_calendar();

    function load_portlet_calendar(event, elem) {
        // depends on plone_javascript_variables.js for portal_url
        event.preventDefault();
        var pw = elem.closest('.portletWrapper');
        var elem_data = elem.data();
        var portlethash = pw.attr('id');
        portlethash = portlethash.substring(15, portlethash.length);
        url = portal_url + '/@@render-portlet?portlethash=' + portlethash +
                '&community=' + elem_data.community +
                '&year=' + elem_data.year +
                '&month=' + elem_data.month;
        if(elem_data.day){
          url += '&day=' + elem_data.day;
        }
        if(elem_data.community_path){
          url += '&community_path=' + elem_data.community_path;
        }
        $.ajax({
            url: url,
            success: function (data) {
                pw.html(data);
                rebind_portlet_calendar();
            }
        });
    }

    function rebind_portlet_calendar() {
        // ajaxify each portletCalendar
        $('.portletCalendar a.calendari-seguent').click(function (event) {
            load_portlet_calendar(event, $(this));
        });
        $('.portletCalendar a.calendari-anterior').click(function (event) {
            load_portlet_calendar(event, $(this));
        });
        $('.portletCalendar .cal_has_events').click(function (event) {
            load_portlet_calendar(event, $(this));
        });
        $('#box_agenda #day').click(function (event) {
            load_portlet_calendar(event, $(this));
        });
        $('.portletCalendar dd a[title]').tooltip({
            offset: [-10, 0],
            tipClass: 'pae_calendar_tooltip'
        });
    }

}); //ready
</script>
