<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      lang="en"
      i18n:domain="genweb.organs">
<body>

<metal:block fill-slot="top_slot"
              tal:define="dummy python:request.set('disable_border',1);
                          disable_column_one python:request.set('disable_plone.leftcolumn',1);
                          disable_column_two python:request.set('disable_plone.rightcolumn',1);" />

<metal:content-core fill-slot="main">
<tal:block i18n:domain="genweb.organs" tal:condition="view/canView"
           tal:define="status view/status;
                       items view/PuntsInside;
                       anonim view/Anonim">

  <!-- TITULO -->
  <div class="d-flex justify-content-between align-items-center border-bottom border-2 border-primary mt-4 mb-3 pb-2">
    <h1 class="text-uppercase mb-0" tal:content="view/getSessionTitle">Ordre del dia</h1>
    <span tal:attributes="class string:p-2 label-${status}" 
          i18n:domain="genweb" i18n:translate="" tal:content="status"></span>
  </div>

  <!-- ACCIONES -->
  <div tal:condition="not:anonim" 
       class="eines-lateral position-fixed top-50 end-0 translate-middle-y me-4 z-3 d-flex flex-column align-items-center gap-1">

    <a href="." title="Tornar a la sessió" class="text-secondary icon-hover">
      <i class="bi bi-house-fill fs-1"></i>
    </a>

    <a href="#viewlet-above-content" title="Inici" class="text-secondary icon-hover">
      <i class="bi bi-chevron-double-up fs-1"></i>
    </a>

    <a id="scrollUp" href="" title="Pujar" class="text-secondary icon-hover">
      <i class="bi bi-chevron-up fs-1"></i>
    </a>

    <a id="scrollDown" href="" title="Baixar" class="text-secondary icon-hover">
      <i class="bi bi-chevron-down fs-1"></i>
    </a>

    <a href="#viewlet-below-content" title="Final" class="text-secondary icon-hover">
      <i class="bi bi-chevron-double-down fs-1"></i>
    </a>

  </div>

  <div tal:condition="items" tal:define="sessionURL view/getSessionURL">

    <!-- EXPAND ALL / COLLAPSE ALL -->
    <div class="d-flex justify-content-end">
      <button id="expandAll" class="btn btn-outline-primary">
        <i class="bi bi-arrows-expand me-1"></i>
        <span i18n:translate="">Desplega tot</span>
      </button>
      <button id="collapseAll" class="btn btn-outline-primary d-none">
        <i class="bi bi-arrows-collapse me-1"></i>
        <span i18n:translate="">Plega tot</span>
      </button>
    </div>

    <!-- ITEMS -->
    <ul class="list-unstyled fs-3">
      <tal:documents repeat="item items">
        <tal:block tal:define="agreement item/agreement">
          <li tal:attributes="id item/id"
              class="border-bottom">
            <div class="row px-3 py-2 justify-content-end">
              <tal:block-contenidos tal:define="files python:view.filesinside(item);
                                                subpunts python:view.SubpuntsInside(item);
                                                contenidos python:files or subpunts">

                <div class="puntTitle col-12 d-flex flex-nowrap align-items-baseline">
                  <div class="fletxaSpan me-2 w-3">
                    <button type="button" class="btn px-0 py-0 btn-expand-collapse collapsed" 
                            tal:condition="contenidos"
                            data-bs-toggle="collapse"
                            tal:attributes="data-bs-target string:#collapse-${item/id}"
                            aria-expanded="false">
                      <i class="bi bi-chevron-down"></i>
                      <i class="bi bi-chevron-up d-none"></i>
                    </button>
                  </div>

                  <div class="numberSpan me-2 w-5 text-end">
                    <span class="proposalNumber text-primary fw-bold fs-2"
                          tal:content="item/proposalPoint"></span>
                  </div>

                  <div class="titleSpan me-2 w-92">
                    <a tal:attributes="data-id item/id; 
                                      href item/absolute_url" 
                      data-url="changeTitle"
                      class="editTitle titleSize text-dark">
                      <tal:omit-tag tal:content="item/title">Item Title</tal:omit-tag>
                    </a>
                    
                    <span tal:condition="agreement" class="text-muted fs-4"
                      tal:attributes="data-agreement string:${item/absolute_url}"
                      tal:content="agreement">
                      [ACORD]
                    </span>

                    <div class="btn-group" role="group" aria-label="Change current state" tal:condition="view/changeEstat">
                      <tal:block tal:condition="item/state">
                        <button class="badge btn btn-outline-secondary ms-2 px-2 py-2 text-dark dropdown-toggle bullet-toggle" type="button"
                                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <i class="bi bi-circle-fill me-1" aria-hidden="true"
                             tal:attributes="style string:color:${item/css}"></i>
                          <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu estatsToggle" role="menu" aria-labelledby="estats">
                          <tal:block repeat="estat item/estats">
                            <li class="defaultValue">
                              <a tabindex="-1" class="dropdown-item"
                                 tal:attributes="href string:${sessionURL}/changeActualState?estat=${estat/title}&id=${item/item_path}">
                                <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                   tal:attributes="style string:color:${estat/color}"></i>
                                <span tal:content="estat/title"></span>
                              </a>
                            </li>
                          </tal:block>
                        </ul>
                      </tal:block>
                    </div>
                  </div>

                </div>
                <div class="collapse multi-collapse-points fs-4" 
                     tal:attributes="id string:collapse-${item/id}" 
                     tal:condition="contenidos">
                  <tal:files tal:condition="files">
                    <ul class="listFiles list-unstyled">
                      <tal:documents repeat="file_item files">
                        <li class="filesinTable w-100 mt-2">
                          <div class="titleSpan">
                            <i tal:attributes="class string:${file_item/classCSS} me-1"></i>
                            <a tal:attributes="href file_item/absolute_url;"
                               class="text-dark">
                              <tal:omit-tag tal:content="file_item/title"> Doc title</tal:omit-tag>
                            </a>
                            <tal:block tal:condition="file_item/isGODocument">
                              <a class="btn btn-outline-success btn-sm ms-2"
                                 tal:condition="file_item/publicRaw"
                                 href="#"
                                 data-bs-toggle="modal"
                                 data-bs-target="#documentContentModal"
                                 tal:attributes="data-content file_item/publicRaw/output;
                                                 data-title string:Contingut públic"
                                 i18n:translate="">
                                Contingut públic
                              </a> 
                              <a class="btn btn-outline-danger btn-sm ms-2"
                                 tal:condition="file_item/reservedRaw"
                                 href="#"
                                 data-bs-toggle="modal"
                                 data-bs-target="#documentContentModal"
                                 tal:attributes="data-content file_item/reservedRaw/output;
                                                 data-title string:Contingut restringit"
                                i18n:translate="">
                                Contingut restringit
                              </a>
                            </tal:block>
                            <tal:block tal:condition="file_item/isGOFile">
                              <a class="btn btn-outline-success btn-sm ms-2"
                                 tal:condition="file_item/publicURL"
                                 href="#"
                                 data-bs-toggle="modal"
                                 data-bs-target="#fileContentModal"
                                 tal:attributes="data-url file_item/publicURL;
                                                 data-title string:Fitxer públic"
                                 i18n:translate="">
                                Fitxer públic
                              </a> 
                              <a class="btn btn-outline-danger btn-sm ms-2"
                                 tal:condition="file_item/reservedURL"
                                 href="#"
                                 data-bs-toggle="modal"
                                 data-bs-target="#fileContentModal"
                                 tal:attributes="data-url file_item/reservedURL;
                                                 data-title string:Fitxer restringit"
                                 i18n:translate="">
                                Fitxer restringit
                              </a> 
                            </tal:block>
                          </div>
                        </li>
                      </tal:documents>
                    </ul>
                  </tal:files>
                  <div tal:condition="subpunts">
                    <tal:subpunts repeat="itemSubpunt subpunts">
                      <div class="li_subgrups row mt-2 justify-content-end" 
                           tal:attributes="id itemSubpunt/id" 
                           tal:define="agreement itemSubpunt/agreement;
                                       itemSubpunt_id itemSubpunt/id;">

                        <div class="subpuntTitle col-12 d-flex flex-nowrap align-items-baseline">
                          <div class="numberSpan me-2 w-5">
                            <span class="proposalNumberSubpunt text-primary fw-bold" 
                                  tal:content="itemSubpunt/proposalPoint"></span>
                          </div>

                          <div class="titleSpan me-2 w-95">
                            <a tal:attributes="data-id itemSubpunt_id; 
                                               href itemSubpunt/absolute_url"
                              data-type="text" data-url="changeTitle" 
                              class="editTitle subtitleSize text-dark">
                              <tal:omit-tag tal:content="itemSubpunt/title">Item Title</tal:omit-tag>
                            </a>
                            <span tal:condition="agreement" class="text-muted fs-5"
                                  tal:attributes="data-agreement string:${itemSubpunt/absolute_url}"
                                  tal:content="agreement">
                              [ACORD]
                            </span>
                            <div class="btn-group" role="group" aria-label="Change current state" tal:condition="view/changeEstat">
                              <tal:block tal:condition="itemSubpunt/state">
                                <button class="badge btn btn-outline-secondary ms-2 px-2 py-2 text-dark dropdown-toggle bullet-toggle" type="button"
                                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                     tal:attributes="style string:color:${itemSubpunt/css}"></i>
                                  <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu estatsToggle" role="menu" aria-labelledby="estats">
                                  <tal:block repeat="estat itemSubpunt/estats">
                                    <li class="defaultValue">
                                      <a tabindex="-1" class="dropdown-item"
                                         tal:attributes="href string:${sessionURL}/changeSubpuntState?estat=${estat/title}&id=${itemSubpunt/id}">
                                        <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                           tal:attributes="style string:color:${estat/color}"></i>
                                        <span tal:content="estat/title"></span>
                                      </a>
                                    </li>
                                  </tal:block>
                                </ul>
                              </tal:block>
                            </div>
                          </div>

                        </div>
                        <tal:files tal:define="files python:view.filesinside(itemSubpunt)">
                          <ul class="listFiles list-unstyled" tal:condition="files">
                            <tal:documents repeat="item files">
                              <li class="filesinTable w-100 mt-2">
                                <i tal:attributes="class string:${item/classCSS} me-1"></i>
                                <a tal:attributes="href item/absolute_url;" 
                                    class="text-dark">
                                  <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                                </a>
                                <tal:block tal:condition="item/isGODocument">
                                  <a class="btn btn-outline-success btn-sm ms-2"
                                     tal:condition="item/publicRaw"
                                     href="#"
                                     data-bs-toggle="modal"
                                     data-bs-target="#documentContentModal"
                                     tal:attributes="data-content item/publicRaw/output;
                                                     data-title string:Contingut públic"
                                     i18n:translate="">
                                    Contingut públic
                                  </a> 
                                  <a class="btn btn-outline-danger btn-sm ms-2"
                                     tal:condition="item/reservedRaw"
                                     href="#"
                                     data-bs-toggle="modal"
                                     data-bs-target="#documentContentModal"
                                     tal:attributes="data-content item/reservedRaw/output;
                                                     data-title string:Contingut restringit"
                                     i18n:translate="">
                                    Contingut restringit
                                  </a>
                                </tal:block>
                                <tal:block tal:condition="item/isGOFile">
                                  <a class="btn btn-outline-success btn-sm ms-2"
                                     tal:condition="item/publicURL"
                                     data-bs-toggle="modal"
                                     data-bs-target="#fileContentModal"
                                     tal:attributes="data-url item/publicURL;
                                                     data-title string:Fitxer públic"
                                     href="#"
                                     i18n:translate="">
                                    Fitxer públic
                                  </a> 
                                  <a class="btn btn-outline-danger btn-sm ms-2"
                                     tal:condition="item/reservedURL"
                                     data-bs-toggle="modal"
                                     data-bs-target="#fileContentModal"
                                     tal:attributes="data-url item/reservedURL;
                                                     data-title string:Fitxer restringit"
                                     href="#"
                                     i18n:translate="">
                                    Fitxer restringit
                                  </a> 
                                </tal:block>
                              </li>
                            </tal:documents>
                          </ul>
                        </tal:files>
                      </div>
                    </tal:subpunts>
                  </div>
                </div>
              </tal:block-contenidos>
            </div>
          </li>
        </tal:block>
      </tal:documents>
    </ul>

    <!-- Modal document -->
    <div class="modal fade" id="documentContentModal" tabindex="-1" 
         aria-labelledby="documentContentModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="documentContentModalLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="documentContentModalBody">
            <!-- El contingut es carregarà aquí -->
          </div>
        </div>
      </div>
    </div>

    <!-- Modal file -->
    <div class="modal fade" id="fileContentModal" tabindex="-1" 
         aria-labelledby="fileContentModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="fileContentModalLabel"></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="fileContentModalBody">
            <!-- El contingut es carregarà aquí -->
            <object id="fileContentModalObject" type="application/pdf" class="w-100" height="720" data="#"></object>
          </div>
        </div>
      </div>
    </div>


  </div>

  <script type="text/javascript"
          src="++theme++genweb.organs/js/content/sessio.min.js"></script>   
          
  <script type="text/javascript"
          src="++theme++genweb.organs/js/content/presentation.min.js"></script>    
  
  <script type="text/javascript"
          src="++theme++genweb.organs/js/content/presentation_modify.min.js"
          tal:condition="view/changeEstat"></script>

</tal:block>
</metal:content-core>

</body>
</html>