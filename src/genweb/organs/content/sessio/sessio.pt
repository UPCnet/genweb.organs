<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="genweb.organs">
  
  <head>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
  </head>

  <metal:main fill-slot="content-core" tal:condition="view/canView"
              tal:define="absolute_url context/absolute_url;
                          loginfo view/getAnnotations;
                          excuses view/getAnnotationsExcuse;
                          canModify view/canModify;
                          items view/PuntsInside;
                          hihaPersones view/hihaPersones;
                          membresConvocats context/membresConvocats;
                          membresConvidats context/membresConvidats;
                          llistaExcusats context/llistaExcusats;
                          assistents context/assistents;
                          noAssistents context/noAssistents;
                          viewHistory view/viewHistory;
                          getAllResultsVotes view/getAllResultsVotes;
                          getInfoQuorums view/getInfoQuorums;
                          viewExcusesAndPoints view/viewExcusesAndPoints;
                          getTitlePrompt view/getTitlePrompt;
                          getErrorPrompt view/getErrorPrompt;
                          canViewVoteButtons view/canViewVoteButtons;
                          canViewAddQuorumButtons view/canViewAddQuorumButtons;
                          canViewManageQuorumButtons view/canViewManageQuorumButtons;
                          canViewManageVote view/canViewManageVote;
                          canViewResultsVote view/canViewResultsVote;
                          acordsInside view/AcordsInside;
                          actesInside view/ActesInside">

    <!-- Token CSRF para formularios AJAX -->
    <tal:csrf tal:replace="structure context/@@authenticator" />

    <!-- Estado de firma -->
    <tal:block tal:condition="view/hasFirma">
      <div class="mb-3" tal:define="estatFirma view/estatFirma">
        <span tal:attributes="class string:py-2 px-3 rounded-pill text-bg-${estatFirma/class} fw-bold  fs-xs">
          <tal:block i18n:translate="">Acta: </tal:block>
          <tal:block tal:content="estatFirma/text">PENDENT_SIGNANTS</tal:block>
        </span>
      </div>
    </tal:block>

    <!-- Barra de acciones -->
    <div class="mb-4 d-flex justify-content-end flex-wrap column-gap-2 sessionActions" role="toolbar">

      <!-- Excusar asistencia -->
      <div tal:condition="view/showOrdreDiaIAssistencia">
        <a tal:attributes="href string:${absolute_url}/excusar_assist_sessio"
           class="btn btn-outline-primary border-0 d-flex flex-column"
           i18n:attributes="title excusa_assistencia; alt excusa_assistencia">
          <i class="bi bi-person-dash"></i>
          <span i18n:translate="">Excusa l'assistencia</span>
        </a>
      </div>

      <!-- Enviar mensaje -->
      <div tal:condition="view/showEnviarButton">
        <a tal:attributes="href string:${absolute_url}/mail_message"
           class="btn btn-outline-primary border-0 d-flex flex-column"
           i18n:attributes="title envia_missatge; alt envia_missatge">
            <i class="bi bi-envelope"></i>
            <span i18n:translate="">Envia missatge</span>
        </a>
      </div>

      <!-- Presentación -->
      <div tal:condition="view/showPresentacionButton">
        <a tal:attributes="href string:${absolute_url}/presentation"
           class="btn btn-warning border-0 d-flex flex-column"
           i18n:attributes="title Presentacio; alt Presentacio">
          <i class="bi bi-play-circle"></i>
          <span i18n:translate="">Presentacio</span>
        </a>
      </div>

      <!-- Publicar -->
      <div tal:condition="view/showPublicarButton">
        <a tal:attributes="href string:${absolute_url}/mail_informar"
           class="btn btn-outline-primary border-0 d-flex flex-column"
           i18n:attributes="title informa_sessio; alt informa_sessio">
          <i class="bi bi-newspaper"></i>
          <span i18n:translate="">Informa sessio</span>
        </a>
      </div>

      <!-- Imprimir -->
      <div>
        <a id="printButlletiBtn" class="btn btn-outline-primary border-0 d-flex flex-column"
           tal:attributes="data-url string:${absolute_url}"
           i18n:attributes="title printOrdreDia; alt printOrdreDia">
          <i class="bi bi-printer"></i>
          <span i18n:translate="">Print</span>
        </a>
        <iframe class="d-none w-0 h-0 border-0" id="printButlletiIframe" name="printButlletiIframe" src=""></iframe>
      </div>

      <!-- Exportar -->
      <div>
        <a tal:attributes="href string:${absolute_url}/exportCSV"
           class="btn btn-outline-primary border-0 d-flex flex-column"
           i18n:attributes="title exportOrdreDia; alt exportOrdreDia">
          <i class="bi bi-download"></i>
          <span i18n:translate="">Export</span>
        </a>
      </div>

      <!-- Quorum -->
      <tal:block tal:condition="canViewManageQuorumButtons">
        <div tal:condition="view/showOpenQuorum">
          <a href="#" class="btn btn-outline-primary border-0 openQuorum d-flex flex-column"
             tal:attributes=" data-url string:${absolute_url}"
             i18n:attributes="title open_quorum; alt open_quorum;">
            <i class="bi bi-people-fill"></i>
            <span i18n:translate="">Obrir quorum</span>
          </a>
        </div>

        <div tal:condition="not:view/showOpenQuorum">
          <a href="#" class="btn btn-outline-primary border-0 closeQuorum d-flex flex-column"
             tal:attributes=" data-url string:${absolute_url}"
             i18n:attributes="title close_quorum; alt close_quorum;">
            <i class="bi bi-people-fill"></i>
            <span i18n:translate="">Tancar quorum</span>
          </a>
        </div>
      </tal:block>

      <!-- Control quorum -->
      <tal:block tal:condition="canViewAddQuorumButtons">
        <div tal:condition="not:view/showOpenQuorum"
             tal:define="checkHasQuorum view/checkHasQuorum">
          <a tal:condition="not:checkHasQuorum" href="#"
             class="btn btn-outline-primary border-0 addQuorum d-flex flex-column"
             tal:attributes=" data-url string:${absolute_url}"
             i18n:attributes="title add_quorum; alt add_quorum;">
            <i class="bi bi-person-plus"></i>
            <span i18n:translate="">Control quorum</span>
          </a>

          <span tal:condition="checkHasQuorum"
                class="btn btn-success addQuorumChecked d-flex flex-column"
                tal:attributes=" data-url string:${absolute_url}"
                i18n:attributes="title added_quorum; alt added_quorum;">
            <i class="bi bi-check2-circle"></i>
            <span i18n:translate="">Control quorum</span>
          </span>
        </div>
      </tal:block>

     <!-- Gestión firma -->
      <tal:block tal:condition="view/canViewSignButton">
        <div>
          <a tal:attributes="href string:${absolute_url}/signSessio"
             class="btn btn-outline-primary border-0 mgDOC d-flex flex-column"
             alt="Gestió signatura i arxiu gDOC" title="Gestió signatura i arxiu gDOC">
            <i class="bi bi-pen"></i>
            <span i18n:translate="">Gestió signatura i arxiu gDOC</span>
          </a>
        </div>
      </tal:block>
    </div>

    <div id="contentSessio" class="mb-4">
      <!-- TABS -->
      <ul class="nav nav-tabs mb-2" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="dadesTab-tab" data-bs-toggle="tab" data-bs-target="#dadesTab"
                  type="button" role="tab" aria-controls="dadesTab" aria-selected="true">
            <i class="bi bi-list"></i>&nbsp;<tal:omit-tag i18n:translate="">Convocatoria</tal:omit-tag>
          </button>
        </li>
        <li tal:condition="hihaPersones" class="nav-item" role="presentation">
          <button class="nav-link" id="assistentsTab-tab" data-bs-toggle="tab" data-bs-target="#assistentsTab"
                  type="button" role="tab" aria-controls="assistentsTab" aria-selected="false">
            <i class="bi bi-people"></i>&nbsp;<tal:omit-tag i18n:translate="">Assistents</tal:omit-tag>
          </button>
        </li>
        <li tal:condition="actesInside" class="nav-item" role="presentation">
          <button class="nav-link" id="actaTab-tab" data-bs-toggle="tab" data-bs-target="#actaTab" type="button"
                  role="tab" aria-controls="actaTab" aria-selected="false">
            <i class="bi bi-file-earmark-text"></i>&nbsp;<tal:omit-tag i18n:translate="">Acta</tal:omit-tag>
          </button>
        </li>
        <li tal:condition="acordsInside" class="nav-item" role="presentation">
          <button class="nav-link" id="acordsTab-tab" data-bs-toggle="tab" data-bs-target="#acordsTab" type="button"
                  role="tab" aria-controls="acordsTab" aria-selected="false">
            <i class="bi bi-check2"></i>&nbsp;<tal:omit-tag i18n:translate="">Agreements list</tal:omit-tag>
          </button>
        </li>
        <li tal:condition="python:loginfo and viewHistory" class="nav-item" role="presentation">
          <button class="nav-link" id="notificationsTab-tab" data-bs-toggle="tab" data-bs-target="#notificationsTab"
                  type="button" role="tab" aria-controls="notificationsTab" aria-selected="false">
            <i class="bi bi-table"></i>&nbsp;<tal:omit-tag i18n:translate="">Historial</tal:omit-tag>
          </button>
        </li>
        <li tal:condition="python:excuses and viewExcusesAndPoints" class="nav-item" role="presentation">
          <button class="nav-link" id="excusesTab-tab" data-bs-toggle="tab" data-bs-target="#excusesTab" type="button"
                  role="tab" aria-controls="excusesTab" aria-selected="false">
            <i class="bi bi-table"></i>&nbsp;<tal:omit-tag i18n:translate="">Info excusats</tal:omit-tag>
          </button>
        </li>
        <tal:block tal:condition="canViewResultsVote">
          <li tal:condition="python: getAllResultsVotes or getInfoQuorums" class="nav-item" role="presentation">
            <button class="nav-link" id="resultsVotesTab-tab" data-bs-toggle="tab" data-bs-target="#resultsVotesTab"
                    type="button" role="tab" aria-controls="resultsVotesTab" aria-selected="false">
              <i class="bi bi-pie-chart"></i>&nbsp;<tal:omit-tag i18n:translate="">Resultats votacions /
                Quorums</tal:omit-tag>
            </button>
          </li>
        </tal:block>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="dadesTab" role="tabpanel" aria-labelledby="dadesTab-tab"
             tal:define="item view/valuesTable">
          <div class="card mb-3">
            <div class="card-body">
              <dl class="row mb-0"
                  tal:define="llocConvocatoria item/llocConvocatoria;
                              linkSala item/linkSala;
                              canViewLinkSala view/canViewLinkSala;
                              modality item/modality;
                              organTitle item/organTitle;
                              horaInici item/horaInici;
                              horaFi item/horaFi;
                              sessionNumber item/sessionNumber;
                              status item/status">

                <dt class="col-sm-4" tal:condition="horaInici">
                  <i class="bi bi-calendar-event text-primary me-2"></i>
                  <span i18n:translate="">Session start date and time</span>
                </dt>
                <dd class="col-sm-8 text-end" tal:condition="horaInici">
                  <span tal:content="horaInici"></span>
                </dd>

                <dt class="col-sm-4" tal:condition="horaFi">
                  <i class="bi bi-calendar-check text-primary me-2"></i>
                  <span i18n:translate="">Session end date and time</span>
                </dt>
                <dd class="col-sm-8 text-end" tal:condition="horaFi">
                  <span tal:content="horaFi"></span>
                </dd>

                <dt class="col-sm-4" tal:condition="modality">
                  <i class="bi bi-camera-video text-primary me-2"></i>
                  <span i18n:translate="">Modality of meet</span>
                </dt>
                <dd class="col-sm-8 text-end" tal:condition="modality">
                  <span i18n:translate="" tal:content="modality"></span>
                </dd>

                <dt class="col-sm-4" tal:condition="llocConvocatoria">
                  <i class="bi bi-geo-alt text-primary me-2"></i>
                  <span i18n:translate="">Session location</span>
                </dt>
                <dd class="col-sm-8 text-end" tal:condition="llocConvocatoria">
                  <span tal:content="llocConvocatoria"></span>
                </dd>

                <tal:block tal:condition="linkSala">
                  <dt class="col-sm-4" tal:condition="canViewLinkSala">
                    <i class="bi bi-link text-primary me-2"></i>
                    <span i18n:translate="">Enllac a la sala</span>
                  </dt>
                  <dd class="col-sm-8 text-end" tal:condition="canViewLinkSala">
                    <a tal:attributes="href linkSala" tal:content="linkSala" target="_blank"></a>
                  </dd>
                </tal:block>

                <dt class="col-sm-4" tal:condition="organTitle">
                  <i class="bi bi-building text-primary me-2"></i>
                  <span i18n:translate="">Organ de govern</span>
                </dt>
                <dd class="col-sm-8 text-end" tal:condition="organTitle">
                  <span tal:content="organTitle"></span>
                </dd>

                <dt class="col-sm-4" tal:condition="sessionNumber">
                  <i class="bi bi-hash text-primary me-2"></i>
                  <span i18n:translate="">Session number</span>
                </dt>
                <dd class="col-sm-8 text-end" tal:condition="sessionNumber">
                  <span tal:content="sessionNumber"></span>
                </dd>

                <dt class="col-sm-4">
                  <i class="bi bi-info-circle text-primary me-2"></i>
                  <span i18n:translate="">Estat de la sessio</span>
                </dt>
                <dd class="col-sm-8 text-end">
                  <span i18n:domain="genweb" i18n:translate="" tal:content="status"
                        tal:attributes="class string:label-${item/state}"></span>
                </dd>
                </dl>
              </div>
          </div>
        </div>

        <div class="tab-pane fade" id="assistentsTab" tal:condition="hihaPersones">
          <div class="card mb-3">
            <div class="card-header">
              <ul class="nav nav-tabs mb-2 card-header-tabs" id="assistentsTabs" role="tablist">
                <li class="nav-item" role="presentation" tal:condition="membresConvocats">
                  <button class="nav-link active" id="tab1primary-tab" data-bs-toggle="tab" data-bs-target="#tab1primary"
                          type="button" role="tab" aria-controls="tab1primary" aria-selected="true">
                    <i class="bi bi-people-fill"></i>&nbsp;<tal:omit-tag i18n:translate="">Incoming members list</tal:omit-tag>
                  </button>
                </li>

                <li class="nav-item" role="presentation" tal:condition="membresConvidats">
                  <button class="nav-link" id="tab2primary-tab" data-bs-toggle="tab" data-bs-target="#tab2primary"
                          type="button" role="tab" aria-controls="tab2primary" aria-selected="false">
                    <i class="bi bi-person-plus"></i>&nbsp;<tal:omit-tag i18n:translate="">Invited members</tal:omit-tag>
                  </button>
                </li>

                <li class="nav-item" role="presentation" tal:condition="llistaExcusats">
                  <button class="nav-link" id="tab3primary-tab" data-bs-toggle="tab" data-bs-target="#tab3primary"
                          type="button" role="tab" aria-controls="tab3primary" aria-selected="false">
                    <i class="bi bi-person-x"></i>&nbsp;<tal:omit-tag i18n:translate="">Excused members</tal:omit-tag>
                  </button>
                </li>

                <li class="nav-item" role="presentation" tal:condition="assistents">
                  <button class="nav-link" id="tab4primary-tab" data-bs-toggle="tab" data-bs-target="#tab4primary"
                          type="button" role="tab" aria-controls="tab4primary" aria-selected="false">
                    <i class="bi bi-person-check"></i>&nbsp;<tal:omit-tag i18n:translate="">Si assistents</tal:omit-tag>
                  </button>
                </li>

                <li class="nav-item" role="presentation" tal:condition="noAssistents">
                  <button class="nav-link" id="tab5primary-tab" data-bs-toggle="tab" data-bs-target="#tab5primary"
                          type="button" role="tab" aria-controls="tab5primary" aria-selected="false">
                    <i class="bi bi-person-x"></i>&nbsp;<tal:omit-tag i18n:translate="">No assistents</tal:omit-tag>
                  </button>
                </li>
              </ul>
            </div>

            <div class="card-body">
              <div class="tab-content">
                <div class="tab-pane fade show active" id="tab1primary" role="tabpanel" tal:condition="membresConvocats">
                  <span tal:replace="structure membresConvocats/output"></span>
                </div>

                <div class="tab-pane fade" id="tab2primary" role="tabpanel" tal:condition="membresConvidats">
                  <span tal:replace="structure membresConvidats/output"></span>
                </div>

                <div class="tab-pane fade" id="tab3primary" role="tabpanel" tal:condition="llistaExcusats">
                  <span tal:replace="structure llistaExcusats/output"></span>
                </div>

                <div class="tab-pane fade" id="tab4primary" role="tabpanel" tal:condition="assistents">
                  <span tal:replace="structure assistents/output"></span>
                </div>

                <div class="tab-pane fade" id="tab5primary" role="tabpanel" tal:condition="noAssistents">
                  <span tal:replace="structure noAssistents/output"></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="actaTab" tal:define="actes actesInside" tal:condition="actesInside">
          <div class="card mb-3">
            <div class="card-header">
              <h5 class="card-title mb-0" i18n:translate="">Actes de la sessio</h5>
            </div>
            <div class="card-body">
              <tal:documents repeat="item actes">
                <a href="#" class="list-group-item list-group-item-action d-flex align-items-center gap-2"
                    tal:attributes="href item/absolute_url"
                    tal:define="date item/date|nothing">
                  <i class="bi bi-file-text text-primary"></i>
                  <div class="flex-grow-1">
                    <span tal:content="item/title">Item Title</span>
                    <small class="text-muted" tal:condition="date">
                      (<span tal:content="date">Item Data</span>)
                    </small>
                  </div>
                </a>
              </tal:documents>
            </div>
          </div>
        </div>

        <div class="tab-pane fade" id="acordsTab" tal:define="acords acordsInside" tal:condition="acordsInside">
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle">
              <thead>
                <tr>
                  <th><tal:data i18n:translate="">Titol</tal:data></th>
                  <th class="text-center"><tal:data i18n:translate="">Agreement</tal:data></th>
                  <th class="text-center"><tal:data i18n:translate="">State</tal:data></th>
                </tr>
              </thead>
              <tbody>
                <tal:documents repeat="item acords">
                  <tr>
                    <td class="w-auto">
                      <i class="bi bi-check"></i>
                      <a href="#" tal:attributes="href item/absolute_url" tal:content="item/title">Item Title</a>
                    </td>
                    <td class="text-center">
                      <span tal:content="item/agreement">Numero Acord</span>
                    </td>
                    <td class="text-center">
                      <div class="btn badge bg-secondary disabled bg-secondaryString fs-xxs">
                        <i class="bi bi-circle-fill me-1" tal:attributes="style string:color:${item/color}"></i>
                        <span tal:content="item/estatsLlista"></span>
                      </div>
                    </td>
                  </tr>
                </tal:documents>
              </tbody>
            </table>
          </div>
        </div>

        <div class="tab-pane fade" id="notificationsTab" tal:condition="python:loginfo and viewHistory">
          <div class="table-responsive mb-3">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th i18n:translate="">Data</th>
                  <th i18n:translate="">Acció</th>
                  <th i18n:translate="">Remitent</th>
                  <th i18n:translate="">Destinataris</th>
                </tr>
              </thead>
              <tbody>
                <tal:documents repeat="data loginfo">
                  <tr>
                    <td tal:content="data/dateMail"></td>
                    <td tal:content="data/message"></td>
                    <td tal:content="data/fromMail"></td>
                    <td tal:content="data/toMail"></td>
                  </tr>
                </tal:documents>
              </tbody>
            </table>
          </div>
        </div>

        <div class="tab-pane fade" id="excusesTab" tal:condition="python:view.getAnnotationsExcuse() and view.viewExcusesAndPoints()">
          <div class="table-responsive mb-3">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>#</th>
                  <th><tal:data i18n:translate="">Data i hora</tal:data></th>
                  <th><tal:data i18n:translate="">Nom</tal:data></th>
                  <th><tal:data i18n:translate="">Email</tal:data></th>
                  <th><tal:data i18n:translate="">Descripcio del problema</tal:data></th>
                </tr>
              </thead>
              <tbody>
                <tal:documents repeat="data excuses">
                  <tr>
                    <td tal:content="data/index|nothing"></td>
                    <td tal:content="data/date"></td>
                    <td tal:content="data/name"></td>
                    <td tal:content="data/email"></td>
                    <td tal:content="data/message"></td>
                  </tr>
                </tal:documents>
              </tbody>
            </table>
          </div>
        </div>

        <div class="tab-pane fade" id="resultsVotesTab" tal:condition="canViewResultsVote"
             tal:define="votes getAllResultsVotes; 
                         quorums getInfoQuorums;">
          <!-- Tabla de votos -->
          <div class="table-responsive mb-3" tal:condition="votes">
            <table class="table table-bordered align-middle mb-0">
              <thead>
                <tr class="align-middle" i18n:domain="genweb.organs">
                  <th width="36%" i18n:translate="">Acord / Esmena</th>
                  <tal tal:condition="not:canViewManageVote">
                    <th width="14%" class="text-center lh-sm" i18n:translate="">A favor</th>
                    <th width="14%" class="text-center lh-sm" i18n:translate="">En contra</th>
                    <th width="14%" class="text-center lh-sm" i18n:translate="">En blanc</th>
                    <th width="14%" class="text-center lh-sm" i18n:translate="">Vots emesos</th>
                    <th width="8%" class="text-center lh-sm" i18n:translate=""></th>
                  </tal>
                  <tal tal:condition="canViewManageVote">
                    <th width="12%" class="text-center lh-sm" i18n:translate="">A favor</th>
                    <th width="12%" class="text-center lh-sm" i18n:translate="">En contra</th>
                    <th width="12%" class="text-center lh-sm" i18n:translate="">En blanc</th>
                    <th width="12%" class="text-center lh-sm" i18n:translate="">Vots emesos</th>
                    <th width="8%" class="text-center lh-sm" i18n:translate="">State</th>
                    <th width="8%" class="text-center lh-sm" i18n:translate=""></th>
                  </tal>
                </tr>
              </thead>
              <tbody>
                <tal:block tal:repeat="vote votes">
                  <tr tal:condition="not:vote/isPublic" tal:attributes="id string:vote-${vote/UID}">
                    <tal:block tal:condition="not:vote/isEsmena">
                      <td>
                        <span tal:content="vote/title"></span>
                        <span class="text-muted fs-s" tal:content="string: [${vote/code}]"></span>
                      </td>
                    </tal:block>
                    <tal:block tal:condition="vote/isEsmena">
                      <td>
                        <div class="ps-4">
                          <span tal:content="vote/title"></span>
                        </div>
                      </td>
                    </tal:block>
                    <tal:block tal:condition="not:vote/isOpen">
                      <td class="vote-favorVote text-center" tal:content="vote/favorVote"></td>
                      <td class="vote-againstVote text-center" tal:content="vote/againstVote"></td>
                      <td class="vote-whiteVote text-center" tal:content="vote/whiteVote"></td>
                      <td class="vote-totalVote text-center" tal:content="vote/totalVote"></td>
                    </tal:block>
                    <tal:block tal:condition="vote/isOpen">
                      <td class="vote-favorVote text-center"></td>
                      <td class="vote-againstVote text-center"></td>
                      <td class="vote-whiteVote text-center"></td>
                      <td class="vote-totalVote text-center" tal:content="vote/totalVote"></td>
                    </tal:block>
                    <td class="text-center" tal:condition="canViewManageVote" tal:content="vote/state"></td>
                    <td class="text-center">
                      <div class="d-flex justify-content-center gap-2">
                        <tal:block tal:condition="canViewManageVote">
                          <button tal:condition="vote/canReopen" class="btn btn-sm btn-outline-primary reopenVote"
                                  tal:attributes="data-url vote/URL" i18n:attributes="title reopen_vote">
                            <i class="bi bi-pencil-square"></i>
                          </button>
                        </tal:block>
                        <tal:block tal:condition="vote/isOpen">
                          <button class="btn btn-sm btn-outline-secondary refreshVote"
                                  tal:attributes="data-uid vote/UID">
                              <i class="bi bi-arrow-clockwise"></i>
                          </button>
                        </tal:block>
                        <tal:block tal:condition="vote/hourOpen">
                          <button tal:condition="not:vote/hourClose" class="btn btn-sm btn-outline-info"
                                  tal:attributes="title string:Inici: ${vote/hourOpen}">
                            <i class="bi bi-info-circle"></i>
                          </button>
                          <button tal:condition="vote/hourClose" class="btn btn-sm btn-outline-info"
                                  tal:attributes="title string:Inici: ${vote/hourOpen} Fi: ${vote/hourClose}">
                            <i class="bi bi-info-circle"></i>
                          </button>
                        </tal:block>
                        <tal:block tal:condition="canViewManageVote">
                          <button tal:condition="vote/isVote" class="btn btn-sm btn-outline-danger removeVote"
                                  tal:attributes="data-url vote/URL">
                            <i class="bi bi-trash"></i>
                          </button>
                        </tal:block>
                      </div>
                    </td>
                  </tr>
                  <tal:block tal:condition="vote/isPublic">
                    <tr class="openInfo" tal:attributes="data-open string:#${vote/UID}; 
                                                         id string:vote-${vote/UID}">
                      <td>
                        <tal:block tal:condition="not:vote/isEsmena">
                          <div class="d-flex align-items-center gap-2">
                            <i class="bi bi-chevron-down text-primary"></i>
                            <i class="bi bi-chevron-up d-none text-primary"></i>
                            <span tal:content="vote/title"></span>
                            <span class="text-muted fs-s" tal:content="string: [${vote/code}]"></span>
                          </div>
                        </tal:block>
                        <tal:block tal:condition="vote/isEsmena">
                          <div class="d-flex align-items-center gap-2 ps-4">
                            <i class="bi bi-chevron-down text-primary"></i>
                            <i class="bi bi-chevron-up d-none text-primary"></i>
                            <span class="vote-title esmena" tal:content="vote/title"></span>
                          </div>
                        </tal:block>
                      </td>
                      <tal:block tal:condition="not:vote/isOpen">
                        <td class="vote-favorVote text-center" tal:content="vote/favorVote"></td>
                        <td class="vote-againstVote text-center" tal:content="vote/againstVote"></td>
                        <td class="vote-whiteVote text-center" tal:content="vote/whiteVote"></td>
                        <td class="vote-totalVote text-center" tal:content="vote/totalVote"></td>
                      </tal:block>
                      <tal:block tal:condition="vote/isOpen">
                        <td class="vote-favorVote text-center"></td>
                        <td class="vote-againstVote text-center"></td>
                        <td class="vote-whiteVote text-center"></td>
                        <td class="vote-totalVote text-center" tal:content="vote/totalVote"></td>
                      </tal:block>
                      <td class="vote-state text-center" tal:condition="canViewManageVote"
                          tal:content="vote/state"></td>
                      <td class="text-center">
                        <div class="d-flex justify-content-center gap-2">
                          <tal:block tal:condition="canViewManageVote">
                        <button tal:condition="vote/canReopen" class="btn btn-sm btn-outline-primary reopenVote"
                            tal:attributes="data-url vote/URL" i18n:attributes="title reopen_vote">
                          <i class="bi bi-pencil-square"></i>
                        </button>
                          </tal:block>
                          <tal:block tal:condition="vote/isOpen">
                        <button class="btn btn-sm btn-outline-secondary refreshVote"
                            tal:attributes="data-uid vote/UID">
                          <i class="bi bi-arrow-clockwise"></i>
                        </button>
                          </tal:block>
                          <tal:block tal:condition="vote/hourOpen">
                        <button tal:condition="not:vote/hourClose" class="btn btn-sm btn-outline-info"
                            tal:attributes="title string:Inici: ${vote/hourOpen}">
                          <i class="bi bi-info-circle"></i>
                        </button>
                        <button tal:condition="vote/hourClose" class="btn btn-sm btn-outline-info"
                            tal:attributes="title string:Inici: ${vote/hourOpen} Fi: ${vote/hourClose}">
                          <i class="bi bi-info-circle"></i>
                        </button>
                          </tal:block>
                          <button tal:condition="canViewManageVote" class="btn btn-sm btn-outline-danger removeVote"
                          tal:attributes="data-url vote/URL">
                        <i class="bi bi-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                    <tr class="infovotes d-none" tal:attributes="id vote/UID">
                      <td></td>
                      <tal:block tal:condition="not:vote/isOpen">
                        <td class="vote-users-favorVote text-center">
                          <p tal:repeat="user vote/favorVoteList" tal:content="user"></p>
                        </td>
                        <td class="vote-users-againstVote text-center">
                          <p tal:repeat="user vote/againstVoteList" tal:content="user"></p>
                        </td>
                        <td class="vote-users-whiteVote text-center">
                          <p tal:repeat="user vote/whiteVoteList" tal:content="user"></p>
                        </td>
                        <td class="text-center"></td>
                      </tal:block>
                      <tal:block tal:condition="vote/isOpen">
                        <td class="vote-users-favorVote text-center"></td>
                        <td class="vote-users-againstVote text-center"></td>
                        <td class="vote-users-whiteVote text-center"></td>
                        <td class="vote-users-totalVote text-center">
                          <p class="mb-0" tal:repeat="user vote/totalVoteList" tal:content="user"></p>
                        </td>
                      </tal:block>
                      <td class="text-center" tal:condition="canViewManageVote"></td>
                      <td class="text-center" tal:condition="canViewManageVote"></td>
                    </tr>
                  </tal:block>
                </tal:block>
              </tbody>
            </table>
          </div>

          <!-- Tabla de quorums -->
          <div class="table-responsive mb-3 mw-50" tal:condition="quorums">
            <table class="table table-bordered align-middle mb-0">
              <thead i18n:domain="genweb.organs">
                <tr>
                  <th colspan="3" i18n:translate="">Nombre de membres assistents</th>
                </tr>
                <tr>
                  <th width="45%" i18n:translate="">Inici</th>
                  <th width="45%" i18n:translate="">Fi</th>
                  <th width="10%" class="text-center" i18n:translate="">Total</th>
                </tr>
              </thead>
              <tbody>
                <tr tal:repeat="quorum quorums">
                  <tal:block tal:define="quorumInfo python: quorums[quorum]">
                    <td tal:content="quorumInfo/start"></td>
                    <td tal:content="quorumInfo/end"></td>
                    <td class="text-center" tal:content="quorumInfo/total"></td>
                  </tal:block>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <tal:buttons tal:condition="canModify">

      <!-- MODAL: Edició de títol -->
      <div class="modal fade" id="modalEditTitle" tabindex="-1" aria-labelledby="modalEditTitleLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalEditTitleLabel" i18n:translate="">Editar Títol</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <label for="edit-title-input" class="form-label" i18n:translate="">Títol</label>
                  <textarea class="form-control" id="edit-title-input" rows="3"></textarea>
                  <input type="hidden" id="edit-title-pk" />
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" i18n:translate="">Cancel·la</button>
              <button type="button" class="btn btn-primary" id="saveTitleButton" i18n:translate=""
                      tal:attributes="data-url absolute_url">Desa els canvis</button>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL: Confirmació genèrica -->
      <div class="modal fade" id="modalConfirm" tabindex="-1" aria-labelledby="modalConfirmLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalConfirmLabel"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" i18n:translate="">Cancel·la</button>
              <button type="button" class="btn btn-danger" id="modalConfirmButton" i18n:translate="">Accepta</button>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL: Creació àgil de punts/acords -->
      <div class="modal fade" id="modalPunts" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
           aria-labelledby="modalMassive" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalMassive" i18n:translate="">Creació àgil</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="alert alert-info">
                <h6 class="alert-heading fs-xl" i18n:translate="">Creació àgil de punts informatius i/o acords a partir d'una llista</h6>
                <p class="mb-0">
                  El format ha de ser un punt/subpunt/acord per línia i sense el número ja que es calcula automàticament.<br />
                  Davant de cada punt/subpunt ha d'anar una <strong>P</strong>. I davant de cada acord una <strong>A</strong>.<br />
                  Els subpunts han de començar per espais en blanc. Dintre d'un punt (P) poden haver subpunts (P) o acords (A).<br />
                  Dintre d'un acord no pot haver res.<br />
                </p>
              </div>

              <!-- Formulario real -->
              <form tal:attributes="action string:${absolute_url}/manualStructureCreation; method string:post; enctype string:multipart/form-data">
                <div class="mb-3">
                  <label for="form-widgets-message" class="form-label" i18n:translate="">Contingut</label>
                  <div class="fieldErrorBox" tal:condition="python: False">
                    <div class="error">Error</div>
                  </div>
                  <textarea class="form-control" name="form.widgets.message" id="form-widgets-message" rows="10"></textarea>
                </div>

                <div class="alert alert-secondary">
                  <h6 class="alert-heading mb-2" i18n:translate="">Exemple de format</h6>
                  <pre class="mb-0">
                    <code>
P Informe del rector
P Comissió Econòmica
  A Aprovació de l'estat de tresoreria
  P Aprovació de l'expedient 03/23
A Discutir tema central
P Conclusions</code>
                  </pre>
                </div>

                <div class="formControls">
                  <input id="form-buttons-send" name="form.buttons.send" class="btn btn-primary" value="Envia" type="submit" i18n:attributes="value">
                  <input id="form-buttons-cancel" name="form.buttons.cancel" class="btn btn-secondary" value="Cancel·la" type="submit" i18n:attributes="value">
                </div>
              </form>
            </div>
          </div>
        </div>  
      </div> 

      <!-- MODAL: Nou punt -->
      <div class="modal fade" id="modalPunt" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="modalAddPunt" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAddPunt" i18n:translate="">Nou punt</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form name="addPunt">
                <div class="mb-3">
                  <label for="new-punt-title" class="form-label" i18n:translate="">Title</label>
                  <textarea class="form-control" id="new-punt-title"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary createPunt" i18n:translate="">Envia</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                      i18n:translate="">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <!-- MODAL: Nou acord -->
      <div class="modal fade" id="modalAcord" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="modalAddAcord" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalAddAcord" i18n:translate="">Nou acord</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form name="addAcord">
                <div class="mb-3">
                  <label for="new-acord-title" class="form-label" i18n:translate="">Titol del punt</label>
                  <textarea class="form-control" id="new-acord-title"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary createAcord" i18n:translate="">Envia</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                      i18n:translate="">Cancel</button>
            </div>
          </div>
        </div>
      </div>

      <!-- BOTONES para abrir modales: Bootstrap 5 usa data-bs-toggle y data-bs-target -->
      <div class="sessionCustomActions d-flex justify-content-end flex-wrap gap-2 mb-5">
        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalPunt">
          <i class="bi bi-plus"></i>
          <span i18n:translate="">Nou punt</span>
        </button>
        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalAcord">
          <i class="bi bi-plus"></i>
          <span i18n:translate="">Nou acord</span>
        </button>
        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#modalPunts">
          <i class="bi bi-database me-1"></i>
          <span i18n:translate="">Creació àgil</span>
        </button>
        <a class="btn btn-outline-primary" tal:attributes="href string:${absolute_url}/updatePoints">
          <i class="bi bi-arrow-clockwise me-1"></i>
          <span i18n:translate="">Numera punts</span>
        </a>
        <a class="btn btn-outline-primary" tal:attributes="href string:${absolute_url}/updateAcords">
          <i class="bi bi-arrow-clockwise me-1"></i>
          <span i18n:translate="">Numera acords</span>
        </a>
      </div>

    </tal:buttons>

    <div tal:condition="view/hihaPunts">
      <div tal:condition="items" class="dades mt-4">
        <div class="d-flex align-middle justify-content-between mb-4">
          <h2 class="sessionOrdreDia mb-0" i18n:translate="">Ordre del dia</h2>
          <div class="d-flex text-end">
            <button id="expandAll" class="btn btn-outline-primary">
              <i class="bi bi-arrows-expand me-1"></i>
              <span i18n:translate="">Desplega tot</span>
            </button>
            <button id="collapseAll" class="btn btn-outline-primary d-none">
              <i class="bi bi-arrows-collapse me-1"></i>
              <span i18n:translate="">Plega tot</span>
            </button>
          </div>
        </div>

        <ul id="sortable">
          <tal:documents repeat="item items">
            <tal:block tal:define="agreement item/agreement; isAcord item/isAcord">
              <li tal:attributes="id item/id;
                                  data-url absolute_url;
                                  class item/classe">
                <div class="row px-3 py-2 justify-content-end" tal:condition="item/show">
                  <div class="col-6 einesSpan d-none d-flex flex-row-reverse justify-content-start align-items-baseline column-gap-2">
                    <tal:editActions tal:condition="python: view.canModifyPunt(item)">
                      <div class="d-flex column-gap-2" aria-label="Edit actions">
                        <tal:block tal:condition="isAcord">
                          <button type="button" class="hide-agreement badge btn btn-secondary fs-xxxs px-2 py-2"
                                  title="Esborra número acord"
                                  data-bs-toggle="modal"
                                  data-bs-target="#modalConfirm"
                                  data-modal-title="Confirmar eliminació del número d'acord"
                                  data-modal-body="Estàs segur que vols eliminar el número d'acord?"
                                  data-modal-action="hideAgreement"
                                  tal:condition="not:item/omitAgreement" 
                                  tal:attributes="data-item item/absolute_url">
                            <i class="bi bi-arrow-counterclockwise"></i>
                          </button>
                        </tal:block>
                        <button type="button" class="edit badge btn btn-primary fs-xxxs px-2 py-2" title="Edit"
                                tal:attributes="data-id item/id; data-title item/title">
                          <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="remove badge btn btn-danger fs-xxxs px-2 py-2"
                                title="Esborra"
                                data-bs-toggle="modal"
                                data-bs-target="#modalConfirm"
                                data-modal-title="Confirmar eliminació"
                                data-modal-body="Estàs segur que vols eliminar aquest element?"
                                data-modal-action="delete"
                                tal:attributes="data-url absolute_url;
                                                data-item item/id; 
                                                data-type item/portal_type">
                          <i class="bi bi-trash"></i>
                        </button>
                      </div>

                      <div class="btn-group" role="group" aria-label="Add element">
                        <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button" data-bs-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                          +
                          <span class="caret"></span>
                        </button>

                        <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                          <li tal:condition="item/isPunt">
                            <a tabindex="-1" class="dropdown-item"
                               tal:attributes="href string:${absolute_url}/${item/id}/++add++genweb.organs.subpunt">
                              <span>
                                <i class="bi bi-list-ul me-1"></i>
                                <tal:omit-tag i18n:translate="">Subpunt</tal:omit-tag>
                              </span>
                            </a>
                          </li>

                          <li tal:condition="item/isPunt">
                            <a tabindex="-1" class="dropdown-item"
                               tal:attributes="href string:${absolute_url}/${item/id}/++add++genweb.organs.acord">
                              <span>
                                <i class="bi bi-check me-1"></i>
                                <tal:omit-tag i18n:translate="">Acord</tal:omit-tag>
                              </span>
                            </a>
                          </li>

                          <li>
                            <a tabindex="-1" class="dropdown-item"
                               tal:attributes="href string:${absolute_url}/${item/id}/++add++genweb.organs.file">
                              <span>
                                <i class="bi bi-file-earmark-text-fill me-1"></i>
                                <tal:omit-tag i18n:translate="">File</tal:omit-tag>
                              </span>
                            </a>
                          </li>

                          <li>
                            <a tabindex="-1" class="dropdown-item"
                               tal:attributes="href string:${absolute_url}/${item/id}/++add++genweb.organs.document">
                              <span>
                                <i class="bi bi-file-earmark-text-fill me-1"></i>
                                <tal:omit-tag i18n:translate="">Document</tal:omit-tag>
                              </span>
                            </a>
                          </li>
                        </ul>
                      </div>

                      <div class="btn-group" role="group" aria-label="Change current state">
                        <tal:block tal:condition="item/state">
                          <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle bullet-toggle" type="button"
                                   data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="bi bi-circle-fill me-1" aria-hidden="true"
                               tal:attributes="style string:color:${item/css}"></i>
                            <span class="caret"></span>
                          </button>
                          <ul class="dropdown-menu estatsToggle" role="menu" aria-labelledby="estats">
                            <tal:block repeat="estat item/estats">
                              <li class="defaultValue">
                                <a tabindex="-1" class="dropdown-item"
                                   tal:attributes="href string:${absolute_url}/changeActualState?estat=${estat/title}&id=${item/item_path}">
                                  <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                     tal:attributes="style string:color:${estat/color}"></i>
                                  <span tal:content="estat/title"></span>
                                </a>
                              </li>
                            </tal:block>
                          </ul>
                        </tal:block>
                      </div>

                      <tal:block tal:condition="isAcord">
                        <tal:block tal:condition="canViewManageVote">
                          <div class="btn-group votes" role="group" aria-label="Open vote"
                               tal:condition="item/canOpenVote">
                            <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button" data-bs-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                              <i class="bi bi-pie-chart me-1" aria-hidden="true"></i>
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                              <li class="openOtherPublicVote" 
                                  tal:attributes="data-id string:${absolute_url}/${item/id};
                                                  data-title getTitlePrompt;
                                                  data-error getErrorPrompt;">
                                <a tabindex="-1" data-type="openOther" class="dropdown-item">
                                  <span>
                                    <i class="bi bi-pie-chart me-1"></i>
                                    <tal:omit-tag i18n:translate="">Other Public</tal:omit-tag>
                                  </span>
                                </a>
                              </li>
                              <li class="openPublicVote" tal:attributes="data-id string:${absolute_url}/${item/id}">
                                <a tabindex="-1" data-type="open" class="dropdown-item">
                                  <span>
                                    <i class="bi bi-pie-chart me-1"></i>
                                    <tal:omit-tag i18n:translate="">Public</tal:omit-tag>
                                  </span>
                                </a>
                              </li>
                            </ul>
                          </div>

                          <div class="btn-group votes" role="group" aria-label="Close vote"
                               tal:condition="item/canCloseVote">
                            <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button" data-bs-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                              <i tal:attributes="class string:${item/classVote} me-1" aria-hidden="true"></i>
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                              <li class="closeVote" tal:attributes="data-id string:${absolute_url}/${item/id}">
                                <a tabindex="-1" data-type="open" class="dropdown-item">
                                  <span>
                                    <i class="bi bi-pie-chart me-1"></i>
                                    <tal:omit-tag i18n:translate="">Close</tal:omit-tag>
                                  </span>
                                </a>
                              </li>
                            </ul>
                          </div>

                          <div class="btn-group votes" role="group" aria-label="Close vote"
                               tal:condition="item/canRecloseVote">
                            <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button" data-bs-toggle="dropdown"
                                    aria-haspopup="true" aria-expanded="false">
                              <i tal:attributes="class string:${item/classVote} me-1" aria-hidden="true"></i>
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                              <li class="recloseVote" tal:attributes="data-id string:${absolute_url}/${item/canRecloseVote}">
                                <a tabindex="-1" data-type="open" class="dropdown-item">
                                  <span>
                                    <i class="bi bi-pie-chart me-1"></i>
                                    <tal:omit-tag i18n:translate="">Close</tal:omit-tag>
                                  </span>
                                </a>
                              </li>
                            </ul>
                          </div>
                        </tal:block>
                      </tal:block>
                    </tal:editActions>

                    <div tal:condition="python: not view.canModifyPunt(item)">
                      <tal:block tal:condition="item/state">
                        <button class="btn badge bg-secondary disabled">
                          <i class="bi bi-circle-fill me-1" aria-hidden="true"
                             tal:attributes="style string:color:${item/css}"></i>
                          <span tal:content="item/state"></span>
                        </button>
                      </tal:block>
                    </div>
                  </div>
                  <tal:block-contenidos tal:define="files python:view.filesinsidePunt(item);
                                                    subpunts python:view.SubpuntsInside(item);
                                                    contenidos python:files or subpunts">
                    <div class="puntTitle col-12 d-flex flex-nowrap align-items-baseline"
                         tal:attributes="id string:punt-${item/id}">
                      <div class="fletxaSpan me-2 w-3">
                        <button type="button" class="btn px-0 py-0 btn-expand-collapse collapsed" 
                                tal:condition="contenidos"
                                data-bs-toggle="collapse"
                                tal:attributes="data-bs-target string:#collapse-${item/id}"
                                aria-expanded="false">
                          <i class="bi bi-chevron-down"></i>
                          <i class="bi bi-chevron-up d-none"></i>
                        </button>
                      </div>

                      <div class="numberSpan me-2 w-5 text-end">
                        <span class="proposalNumber text-primary fs-xxxl fw-bold"
                              tal:content="item/proposalPoint"></span>
                      </div>

                      <div class="titleSpan me-2 w-72">
                        <a tal:attributes="data-id item/id; 
                                          href item/absolute_url" 
                          data-url="changeTitle"
                          class="editTitle titleSize text-dark">
                          <tal:omit-tag tal:content="item/title">Item Title</tal:omit-tag>
                        </a>
                        <span tal:condition="agreement" class="text-muted fs-s"
                              tal:attributes="data-agreement string:${item/absolute_url}">
                          [<tal:omit-tag i18n:translate="">acord</tal:omit-tag> <tal:omit-tag
                                        tal:content="agreement">Acord code </tal:omit-tag>]
                        </span>
                        <tal:block tal:condition="canViewResultsVote">
                          <span tal:condition="item/canRecloseVote" class="subtitleSize">
                            <br />
                            <tal:omit-tag i18n:translate="">Vote</tal:omit-tag>:
                            <tal:omit-tag tal:content="item/titleEsmena"></tal:omit-tag>
                          </span>
                        </tal:block>
                      </div>

                      <div class="boleta w-20 text-end" tal:define="estat item/state">
                        <span class="btn badge bg-secondary disabled bg-secondaryString fs-xxs">
                          <i class="bi bi-circle-fill me-1" aria-hidden="true"
                            tal:attributes="style string:color:${item/css}"></i>
                          <span tal:content="estat"></span>
                        </span>
                      </div>
                    </div>

                    <tal:block tal:condition="canViewVoteButtons">
                      <div class="puntVoteButtons col-12 row mt-2" tal:condition="item/canCloseVote">
                        <span class="col-1"></span>
                        <div class="col-11 row">
                          <div class="col-4" tal:condition="not:item/favorVote">
                            <a class="btn btn-outline-primary btn-notvote favor w-100" 
                                tal:attributes="data-id string:${absolute_url}/${item/id}"
                                i18n:translate="">A favor</a>
                          </div>
                          <div class="col-4" tal:condition="item/favorVote">
                            <a class="btn btn-primary disabled w-100" i18n:translate="">A favor</a>
                          </div>
                          <div class="col-4" tal:condition="not:item/againstVote">
                            <a class="btn btn-outline-primary btn-notvote against w-100" 
                                tal:attributes="data-id string:${absolute_url}/${item/id}"
                                i18n:translate="">En contra</a>
                          </div>
                          <div class="col-4" tal:condition="item/againstVote"> 
                            <a class="btn btn-primary disabled w-100" i18n:translate="">En contra</a>
                          </div>
                          <div class="col-4" tal:condition="not:item/whiteVote">
                            <a class="btn btn-outline-primary btn-notvote white w-100" 
                                tal:attributes="data-id string:${absolute_url}/${item/id}"
                                i18n:translate="">En blanc</a>
                          </div>
                          <div class="col-4" tal:condition="item/whiteVote">
                            <a class="btn btn-primary disabled w-100" i18n:translate="">En blanc</a>
                          </div>
                        </div>
                      </div>
                      <div class="puntVoteButtons col-12 row mt-2" tal:condition="item/canRecloseVote">
                        <span class="col-1"></span>
                        <div class="col-11 row">
                          <div class="col-4" tal:condition="not:item/favorVote">
                            <a class="btn btn-outline-primary btn-notvote favor w-100" 
                                tal:attributes="data-id string:${absolute_url}/${item/canRecloseVote}"
                                i18n:translate="">A favor</a>
                          </div>
                          <div class="col-4" tal:condition="item/favorVote">
                            <a class="btn btn-primary disabled w-100" i18n:translate="">A favor</a>
                          </div>
                          <div class="col-4" tal:condition="not:item/againstVote">
                            <a class="btn btn-outline-primary btn-notvote against w-100" 
                                tal:attributes="data-id string:${absolute_url}/${item/canRecloseVote}"
                                i18n:translate="">En contra</a>
                          </div>
                          <div class="col-4" tal:condition="item/againstVote">
                            <a class="btn btn-primary disabled w-100" i18n:translate="">En contra</a>
                          </div>
                          <div class="col-4" tal:condition="not:item/whiteVote">
                            <a class="btn btn-outline-primary btn-notvote white w-100" 
                                tal:attributes="data-id string:${absolute_url}/${item/canRecloseVote}"
                                i18n:translate="">En blanc</a>
                          </div>
                          <div class="col-4" tal:condition="item/whiteVote">
                            <a class="btn btn-primary disabled w-100" i18n:translate="">En blanc</a>
                          </div>
                        </div>
                      </div>
                    </tal:block>

                    <div class="collapse multi-collapse-points" 
                        tal:attributes="id string:collapse-${item/id}" 
                        tal:condition="contenidos">
                      <tal:files tal:condition="files">
                        <ul class="listFiles list-unstyled">
                          <tal:documents repeat="file_item files">
                            <li class="filesinTable w-100 mt-2">
                              <div class="titleSpan">
                                <i tal:attributes="class string:${file_item/classCSS} me-1"></i>
                                <a tal:attributes="href file_item/absolute_url;" 
                                  tal:condition="file_item/new_tab"
                                  target="_blank"
                                  class="text-dark">
                                  <tal:omit-tag tal:content="file_item/title"> Doc title</tal:omit-tag>
                                </a>
                                <a tal:attributes="href file_item/absolute_url;"
                                  tal:condition="not:file_item/new_tab"
                                  class="text-dark">
                                  <tal:omit-tag tal:content="file_item/title"> Doc title</tal:omit-tag>
                                </a>
                                <div class="float-end"
                                    tal:condition="python:view.canModifyPunt(item)">
                                  <button type="button" class="remove badge btn btn-danger fs-xxxs px-2 py-2"
                                          title="Esborra"
                                          data-bs-toggle="modal"
                                          data-bs-target="#modalConfirm"
                                          data-modal-title="Confirmar eliminació"
                                          data-modal-body="Estàs segur que vols eliminar aquest element?"
                                          data-modal-action="delete"
                                          tal:attributes="data-url absolute_url;
                                                          data-item file_item/id; 
                                                          data-type file_item/portal_type">
                                    <i class="bi bi-trash" aria-hidden="true"></i>
                                  </button>
                                </div>
                              </div>
                            </li>
                          </tal:documents>
                        </ul>
                      </tal:files>

                      <div tal:condition="subpunts" class="sortable2">
                        <tal:subpunts repeat="itemSubpunt subpunts">
                          <div class="li_subgrups row mt-2 justify-content-end" 
                               tal:attributes="id itemSubpunt/id;
                                               data-url absolute_url" 
                               tal:define="agreement itemSubpunt/agreement;
                                           itemSubpunt_id itemSubpunt/id;
                                           isAcord itemSubpunt/isAcord">
                            <div class="col-6 einesSpan d-none d-flex flex-row-reverse justify-content-start align-items-baseline column-gap-2">
                              <tal:editActions tal:condition="python: view.canModifyPunt(itemSubpunt)">
                                <div class="d-flex column-gap-2" aria-label="Edit actions">
                                  <tal:block tal:condition="isAcord">
                                    <button type="button" class="hide-agreement badge btn btn-secondary fs-xxxs px-2 py-2"
                                            title="Esborra número acord"
                                            data-bs-toggle="modal"
                                            data-bs-target="#modalConfirm"
                                            data-modal-title="Confirmar eliminació del número d'acord"
                                            data-modal-body="Estàs segur que vols eliminar el número d'acord?"
                                            data-modal-action="hideAgreement"
                                            tal:condition="not:itemSubpunt/omitAgreement"
                                            tal:attributes="data-item itemSubpunt/absolute_url">
                                      <i class="bi bi-arrow-counterclockwise"></i>
                                    </button>
                                  </tal:block>
                                  <button type="button" class="edit2 badge btn btn-primary fs-xxxs px-2 py-2" title="Edit"
                                          tal:attributes="data-id itemSubpunt_id; data-title itemSubpunt/title">
                                    <i class="bi bi-pencil" aria-hidden="true"></i>
                                  </button>
                                  <button type="button" class="remove badge btn btn-danger fs-xxxs px-2 py-2"
                                          title="Esborra"
                                          data-bs-toggle="modal"
                                          data-bs-target="#modalConfirm"
                                          data-modal-title="Confirmar eliminació"
                                          data-modal-body="Estàs segur que vols eliminar aquest element?"
                                          data-modal-action="delete"
                                          tal:attributes="data-url absolute_url;
                                                          data-item itemSubpunt_id; 
                                                          data-type itemSubpunt/portal_type">
                                    <i class="bi bi-trash"></i>
                                  </button>
                                </div>
                                
                                <div class="btn-group" role="group" style="float: right;" aria-label="Add element">
                                  <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" 
                                          type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    +
                                    <span class="caret"></span>
                                  </button>

                                  <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                                    <li>
                                      <a tabindex="-1" class="dropdown-item"
                                         tal:attributes="href string:${absolute_url}/${itemSubpunt_id}/++add++genweb.organs.file">
                                        <span>
                                          <i class="bi bi-file-earmark-pdf-fill me-1"></i>
                                          <tal:omit-tag i18n:translate="">File</tal:omit-tag>
                                        </span>
                                      </a>
                                    </li>

                                    <li>
                                      <a tabindex="-1" class="dropdown-item"
                                         tal:attributes="href string:${absolute_url}/${itemSubpunt_id}/++add++genweb.organs.document">
                                        <span>
                                          <i class="bi bi-file-earmark-text-fill me-1"></i>
                                          <tal:omit-tag i18n:translate="">Document</tal:omit-tag>
                                        </span>
                                      </a>
                                    </li>
                                  </ul>
                                </div>

                                <div class="btn-group" role="group" aria-label="Change current state">
                                  <tal:block tal:condition="itemSubpunt/state">
                                    <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle bullet-toggle" id="estats"
                                            type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                         tal:attributes="style string:color:${itemSubpunt/css}"></i>
                                      <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu estatsToggle" role="menu" aria-labelledby="estats">
                                      <tal:block repeat="estat itemSubpunt/estats">
                                        <li class="defaultValue">
                                          <a tabindex="-1" class="dropdown-item"
                                             tal:attributes="href string:${absolute_url}/changeSubpuntState?estat=${estat/title}&id=${itemSubpunt_id}">
                                            <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                               tal:attributes="style string:color:${estat/color}"></i>
                                            <span tal:content="estat/title"></span>
                                          </a>
                                        </li>
                                      </tal:block>
                                    </ul>
                                  </tal:block>
                                </div>

                                <tal:block tal:condition="isAcord">
                                  <tal:block tal:condition="canViewManageVote">
                                    <div class="btn-group votes" role="group"
                                         aria-label="Open vote" tal:condition="itemSubpunt/canOpenVote">
                                      <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button"
                                              data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="bi bi-pie-chart me-1" aria-hidden="true"></i>
                                        <span class="caret"></span>
                                      </button>
                                      <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                                        <li class="openOtherPublicVote" 
                                            tal:attributes="data-id string:${absolute_url}/${itemSubpunt/id};
                                                            data-title getTitlePrompt;
                                                            data-error getErrorPrompt;">
                                          <a tabindex="-1" data-type="openOther" class="dropdown-item">
                                            <span>
                                              <i class="bi bi-pie-chart me-1"></i>
                                              <tal:omit-tag i18n:translate="">Other Public</tal:omit-tag>
                                            </span>
                                          </a>
                                        </li>
                                        <li class="openPublicVote" tal:attributes="data-id string:${absolute_url}/${itemSubpunt/id}">
                                          <a tabindex="-1" data-type="open" class="dropdown-item">
                                            <span>
                                              <i class="bi bi-pie-chart me-1"></i>
                                              <tal:omit-tag i18n:translate="">Public</tal:omit-tag>
                                            </span>
                                          </a>
                                        </li>
                                      </ul>
                                    </div>

                                    <div class="btn-group votes" role="group"
                                         aria-label="Close vote" tal:condition="itemSubpunt/canCloseVote">
                                      <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button"
                                              data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i tal:attributes="class itemSubpunt/classVote" aria-hidden="true"></i>
                                        <span class="caret"></span>
                                      </button>
                                      <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                                        <li class="closeVote" tal:attributes="data-id string:${absolute_url}/${itemSubpunt/id}">
                                          <a tabindex="-1" data-type="open" class="dropdown-item">
                                            <span>
                                              <i class="bi bi-pie-chart me-1"></i>
                                              <tal:omit-tag i18n:translate="">Close</tal:omit-tag>
                                            </span>
                                          </a>
                                        </li>
                                      </ul>
                                    </div>

                                    <div class="btn-group votes" role="group" 
                                         aria-label="Close vote" tal:condition="itemSubpunt/canRecloseVote">
                                      <button class="badge btn btn-outline-secondary fs-xxxs px-2 py-2 text-dark dropdown-toggle" type="button"
                                              data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i tal:attributes="class itemSubpunt/classVote" aria-hidden="true"></i>
                                        <span class="caret"></span>
                                      </button>
                                      <ul class="dropdown-menu" role="menu" aria-labelledby="types">
                                        <li class="recloseVote" tal:attributes="data-id string:${absolute_url}/${itemSubpunt/canRecloseVote}">
                                          <a tabindex="-1" data-type="open" class="dropdown-item">
                                            <span>
                                              <i class="bi bi-pie-chart me-1"></i>
                                              <tal:omit-tag i18n:translate="">Close</tal:omit-tag>
                                            </span>
                                          </a>
                                        </li>
                                      </ul>
                                    </div>

                                  </tal:block>
                                </tal:block>
                              </tal:editActions>

                              <div tal:condition="not:python: view.canModifyPunt(itemSubpunt)">
                                <tal:block tal:condition="itemSubpunt/state">
                                  <button class="btn badge bg-secondary disabled fs-xxs">
                                    <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                       tal:attributes="style string:color:${itemSubpunt/css}"></i>
                                    <span tal:content="itemSubpunt/state"></span>
                                  </button>
                                </tal:block>
                              </div>
                            </div>

                            <div class="subpuntTitle col-12 d-flex flex-nowrap align-items-baseline"
                                 tal:attributes="id string:subpunt-${itemSubpunt/id}">
                              <div class="numberSpan me-2 w-5">
                                <span class="proposalNumberSubpunt text-primary fw-bold" 
                                      tal:content="itemSubpunt/proposalPoint"></span>
                              </div>
                              <div class="titleSpan me-2 w-75">
                                <a tal:attributes="data-id itemSubpunt_id; 
                                                   href itemSubpunt/absolute_url"
                                   data-type="text" data-url="changeTitle" 
                                   class="editTitle subtitleSize text-dark">
                                  <tal:omit-tag tal:content="itemSubpunt/title">Item Title</tal:omit-tag>
                                </a>
                                <span tal:condition="agreement" class="text-muted fs-s"
                                      tal:attributes="data-agreement string:${itemSubpunt/absolute_url}">
                                  [<tal:omit-tag i18n:translate="">acord</tal:omit-tag> <tal:omit-tag
                                    tal:content="agreement">Acord code </tal:omit-tag>]
                                </span>
                                <tal:block tal:condition="canViewVoteButtons">
                                  <span tal:condition="itemSubpunt/canRecloseVote">
                                    <br />
                                    <tal:omit-tag i18n:translate="">Vote</tal:omit-tag>:
                                    <tal:omit-tag tal:content="itemSubpunt/titleEsmena"></tal:omit-tag>
                                  </span>
                                </tal:block>
                              </div>
                              <div class="boleta w-20 text-end" tal:define="estat itemSubpunt/state">
                                <span class="btn badge bg-secondary disabled bg-secondaryString fs-xxs">
                                  <i class="bi bi-circle-fill me-1" aria-hidden="true"
                                     tal:attributes="style string:color:${itemSubpunt/css}"></i>
                                  <span tal:content="estat"></span>
                                </span>
                              </div>
                            </div>

                            <tal:block tal:condition="canViewVoteButtons">
                              <div class="puntVoteButtons col-12 row mt-2" tal:condition="itemSubpunt/canCloseVote">
                                <span class="col-1"></span>
                                <div class="col-11 hasVote row">
                                  <div class="col-4" tal:condition="not:itemSubpunt/favorVote">
                                    <a class="btn btn-outline-primary btn-notvote favord w-100" 
                                        tal:attributes="data-id string:${absolute_url}/${itemSubpunt_id}"
                                        i18n:translate="">A favor</a>
                                  </div>
                                  <div class="col-4" tal:condition="itemSubpunt/favorVote">
                                    <a class="btn btn-primary disabled w-100 disabled w-100" i18n:translate="">A favor</a>
                                  </div>
                                  <div class="col-4" tal:condition="not:itemSubpunt/againstVote">
                                    <a class="btn btn-outline-primary btn-notvote againstd w-100" 
                                      tal:attributes="data-id string:${absolute_url}/${itemSubpunt_id}"
                                      i18n:translate="">En contra</a>
                                  </div>
                                  <div class="col-4" tal:condition="itemSubpunt/againstVote">
                                    <a class="btn btn-primary disabled w-100" i18n:translate="">En contra</a>
                                  </div>
                                  <div class="col-4" tal:condition="not:itemSubpunt/whiteVote">
                                    <a class="btn btn-outline-primary btn-notvote whited w-100" 
                                      tal:attributes="data-id string:${absolute_url}/${itemSubpunt_id}"
                                      i18n:translate="">En blanc</a>
                                  </div>
                                  <div class="col-4" tal:condition="itemSubpunt/whiteVote">
                                    <a class="btn btn-primary disabled w-100" i18n:translate="">En blanc</a>
                                  </div>
                                </div>
                              </div>
                              <div class="puntVoteButtons col-12 row mt-2" tal:condition="itemSubpunt/canRecloseVote">
                                <span class="col-1"></span>
                                <div class="col-11 hasVote row">
                                  <div class="col-4" tal:condition="not:itemSubpunt/favorVote">
                                    <a class="btn btn-outline-primary btn-notvote favord w-100"
                                      tal:attributes="data-id string:${absolute_url}/${itemSubpunt/canRecloseVote}"
                                      i18n:translate="">A favor</a>
                                  </div>
                                  <div class="col-4" tal:condition="itemSubpunt/favorVote">
                                    <a class="btn btn-primary disabled w-100" i18n:translate="">A favor</a>
                                  </div>
                                  <div class="col-4" tal:condition="not:itemSubpunt/againstVote">
                                    <a class="btn btn-outline-primary btn-notvote againstd w-100"
                                      tal:attributes="data-id string:${absolute_url}/${itemSubpunt/canRecloseVote}"
                                      i18n:translate="">En contra</a>
                                  </div>
                                  <div class="col-4" tal:condition="itemSubpunt/againstVote">
                                    <a class="btn btn-primary disabled w-100" i18n:translate="">En contra</a>
                                  </div>
                                  <div class="col-4" tal:condition="not:itemSubpunt/whiteVote">
                                    <a class="btn btn-outline-primary btn-notvote whited w-100"
                                      tal:attributes="data-id string:${absolute_url}/${itemSubpunt/canRecloseVote}"
                                      i18n:translate="">En blanc</a>
                                  </div>
                                  <div class="col-4" tal:condition="itemSubpunt/whiteVote">
                                    <a class="btn btn-primary disabled w-100" i18n:translate="">En blanc</a>
                                  </div>
                                </div>
                              </div>
                            </tal:block>

                            <tal:files tal:define="files python:view.filesinsidePunt(itemSubpunt)">
                              <ul class="listFiles list-unstyled" tal:condition="files">
                                <tal:documents repeat="item files">
                                  <li class="filesinTable w-100 mt-2">
                                    <i tal:attributes="class string:${item/classCSS} me-1"></i>
                                    <a tal:attributes="href item/absolute_url;" 
                                        tal:condition="item/new_tab"
                                        target="_blank"
                                        class="text-dark">
                                      <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                                    </a>
                                    <a tal:attributes="href item/absolute_url;" 
                                        tal:condition="not:item/new_tab"
                                        class="text-dark">
                                      <tal:omit-tag tal:content="item/title"> Doc title</tal:omit-tag>
                                    </a>
                                    <div class="float-end"
                                          tal:condition="python: view.canModifyPunt(itemSubpunt)">
                                      <button type="button" class="remove badge btn btn-danger fs-xxxs px-2 py-2"
                                              title="Esborra"
                                              data-bs-toggle="modal"
                                              data-bs-target="#modalConfirm"
                                              data-modal-title="Confirmar eliminació"
                                              data-modal-body="Estàs segur que vols eliminar aquest element?"
                                              data-modal-action="delete"
                                              tal:attributes="data-url absolute_url;
                                                              data-item item/id; 
                                                              data-type item/portal_type">
                                      <i class="bi bi-trash" aria-hidden="true"></i></button>
                                    </div>
                                  </li>
                                </tal:documents>
                              </ul>
                            </tal:files>
                          </div>
                        </tal:subpunts>
                      </div>
                    </div>
                  </tal:block-contenidos>
                </div>
              </li>
            </tal:block>
          </tal:documents>
        </ul>
      </div>
    </div>

    <script type="text/javascript"
            src="++theme++genweb.organs/js/jquery-ui.min.js"></script>    

    <script type="text/javascript"
            src="++theme++genweb.organs/js/content/sessio.min.js"></script>    

    <script type="text/javascript"
            src="++theme++genweb.organs/js/content/sessio_modify.min.js"
            tal:condition="canModify"></script>    

    <script type="text/javascript"
            src="++theme++genweb.organs/js/content/sessio_quorum_manage.min.js"
            tal:condition="canViewManageQuorumButtons"></script>

    <script type="text/javascript"
            src="++theme++genweb.organs/js/content/sessio_quorum_add.min.js"
            tal:condition="canViewAddQuorumButtons"></script>

    <script type="text/javascript"
            src="++theme++genweb.organs/js/content/sessio_vote_manage.min.js"
            tal:condition="canViewManageVote"></script>

    <script type="text/javascript"
            src="++theme++genweb.organs/js/content/sessio_vote_view.min.js"
            tal:condition="canViewVoteButtons"></script>

  </metal:main>
</html>