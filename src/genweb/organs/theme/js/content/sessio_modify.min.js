function hideAgreement(t){jQuery.ajax({type:"POST",url:t+"/hide-agreement",success:function(){window.location.reload()},error:function(){alert("Error en l'operació")}})}function deleteElement(t,e){let a=CSS.escape(t);jQuery.ajax({type:"POST",url:window.location.href.split("?")[0].replace(/\/$/,"")+"/deleteElement",data:{action:"delete",id:t,type:e},success:function(){jQuery("#"+a).fadeOut("slow",function(){$(this).remove()})},error:function(){alert("Error on deleting element"),window.location.reload()}})}$(document).ready(function(){$("#sortable").sortable({placeholder:"ui-state-highlight",opacity:.5,scroll:!1,start:function(t,e){start=e.item.index()},update:function(t,e){var a={};a.itemid=e.item.attr("id"),a.action="movepunt",a.delta=e.item.index()-start,$.ajax({type:"POST",url:"@@fcmoveTable",data:a,success:function(){setTimeout(()=>window.location.reload(),500)}})}}).disableSelection(),$(".sortable2").sortable({placeholder:"ui-state-highlight2",opacity:.5,scroll:!1,start:function(t,e){start=e.item.index()},update:function(t,e){var a={};a.itemid=e.item.attr("id"),a.action="movesubpunt",a.delta=e.item.index()-start,$.ajax({type:"POST",url:"@@fcmoveTable",data:a,success:function(){setTimeout(()=>window.location.reload(),500)}})}}).disableSelection(),$(".ui-sortable li").on("click",function(t){var e=$(this);e.hasClass("picked")||($(".ui-sortable li.picked").each(function(){$(this).removeClass("picked").find(".einesSpan").toggleClass("d-none"),$(this).find(".boleta").show()}),e.addClass("picked"),e.find(".einesSpan").toggleClass("d-none"),e.find(".boleta").hide())}),$(window).on("click.Bst",function(t){0<$(t.target).closest(".modal").length||0===$(t.target).closest("#sortable").length&&$(".ui-sortable li.picked").each(function(){$(this).removeClass("picked").find(".einesSpan").toggleClass("d-none"),$(this).find(".boleta").show()})});let e=document.getElementById("modalPunt"),a=(e&&e.addEventListener("hidden.bs.modal",()=>{var t=e.querySelector("#new-punt-title");t&&(t.value="")}),document.getElementById("modalAcord")),i=(a&&a.addEventListener("hidden.bs.modal",()=>{var t=a.querySelector("#new-acord-title");t&&(t.value="")}),$(".createPunt").on("click",function(t){t.preventDefault(),t.stopPropagation();t=$("#new-punt-title").val();t&&""!==t.trim()?$.ajax({type:"POST",url:window.location.href.split("?")[0].replace(/\/$/,"")+"/@@createElement",data:{action:"createPunt",name:t},success:function(){var t=bootstrap.Modal.getInstance(e);t&&t.hide(),setTimeout(()=>window.location.reload(),500)},error:function(){alert("Hi ha hagut un error al crear el punt.")}}):alert("El títol no pot estar buit.")}),$(".createAcord").on("click",function(t){t.preventDefault(),t.stopPropagation();t=$("#new-acord-title").val();t&&""!==t.trim()?$.ajax({type:"POST",url:window.location.href.split("?")[0].replace(/\/$/,"")+"/@@createElement",data:{action:"createAcord",name:t},success:function(){var t=bootstrap.Modal.getInstance(a);t&&t.hide(),setTimeout(()=>window.location.reload(),500)},error:function(){alert("Hi ha hagut un error al crear l'acord.")}}):alert("El títol no pot estar buit.")}),document.getElementById("modalConfirm"));i&&i.addEventListener("show.bs.modal",t=>{let e=t.relatedTarget;var t=e.getAttribute("data-modal-title"),a=e.getAttribute("data-modal-body");let o=e.getAttribute("data-modal-action");i.querySelector(".modal-title").textContent=t,i.querySelector(".modal-body").textContent=a;t=i.querySelector("#modalConfirmButton");$(t).off("click").on("click",function(){"delete"===o?deleteElement(e.getAttribute("data-item"),e.getAttribute("data-type")):"hideAgreement"===o&&hideAgreement(e.getAttribute("data-item-url")),bootstrap.Modal.getInstance(i).hide()})});var t=document.getElementById("modalEditTitle");if(t){let a=new bootstrap.Modal(t);$("#sortable").on("click",".edit, .edit2, a.editTitle",function(t){t.preventDefault(),t.stopPropagation();var t=$(this).data("id"),e=$(this).is("a")?$(this).text().trim():$(this).data("title");$("#edit-title-input").val(e),$("#edit-title-pk").val(t),a.show()}),$("#saveTitleButton").on("click",function(){let t=$("#edit-title-pk").val(),e=$("#edit-title-input").val();e?$.ajax({url:"changeTitle",type:"POST",data:{pk:t,value:e},success:function(){$('a.editTitle[data-id="'+t+'"]').text(e),$('button.edit[data-id="'+t+'"], button.edit2[data-id="'+t+'"]').data("title",e),a.hide()},error:function(){alert("Hi ha hagut un error al desar el títol.")}}):alert("El títol no pot estar buit.")})}$("li.defaultValue").on("click",function(){var t=$(this).find(".bi-circle-fill").css("color"),e=$(this).closest(".btn-group");e.find(".bullet-toggle > i").css({color:t}),e.closest(".einesSpan").parent().find(".boleta > span > i").css({color:t})}),$("#importPointsButton").on("click",function(t){t.preventDefault(),t.stopPropagation();var e,t=$("#manual-import-text").val();t&&""!==t.trim()?((e=$("<form>",{method:"POST",action:window.location.href.split("?")[0].replace(/\/$/,"")+"/manualStructureCreation"})).append($("<input>",{type:"hidden",name:"form.widgets.message",value:t})),e.append($("<input>",{type:"hidden",name:"form.buttons.send",value:"Send"})),$("body").append(e),e.submit()):alert("El contingut no pot estar buit.")});let o=document.getElementById("modalPunts");o&&o.addEventListener("hidden.bs.modal",()=>{var t=o.querySelector("#manual-import-text");t&&(t.value="")})});